"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var getAllAttributes = function getAllAttributes(element) {
  var attributeDetails = {};

  if (!element.attributes) {
    return {};
  }

  var attributes = Array.prototype.slice.call(element.attributes);
  attributes.forEach(function (attribute) {
    attributeDetails[attribute.nodeName] = attribute.nodeValue;
  });
  return attributeDetails;
};

var constructParentsArray = function constructParentsArray(element) {
  var parentArray = [];
  var index = 0;

  if (!element.parentElement) {
    return parentArray;
  }

  element = element.parentElement;

  while (element !== null && index < 10) {
    index += 1;
    parentArray.push(getDirectDetails(element));
    element = element.parentElement;
  }

  return parentArray;
};

var constructDirectChildrenArray = function constructDirectChildrenArray(element) {
  var childrenArray = [];

  if (!element.children) {
    return null;
  }

  var children = Array.prototype.slice.call(element.children);
  children.forEach(function (child) {
    childrenArray.push({
      details: getDirectDetails(child),
      children: constructDirectChildrenArray(child)
    });
  });
  return childrenArray;
};

var constructElementDetails = function constructElementDetails(selector, testLineItemId) {
  var requestedByExtension = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
  var domElement = document.querySelector(selector);

  if (!domElement || !window.trudonGlobals && !requestedByExtension) {
    return null;
  }

  var elementDetails = getDirectDetails(domElement);

  if (testLineItemId) {
    elementDetails.testLineItemId = testLineItemId;
  }

  elementDetails.selector = selector;
  elementDetails.nextSibling = domElement.nextElementSibling ? getDirectDetails(domElement.nextElementSibling) : null;
  elementDetails.previousSibling = domElement.previousElementSibling ? getDirectDetails(domElement.previousElementSibling) : null;
  elementDetails.parents = constructParentsArray(domElement);
  elementDetails.children = constructDirectChildrenArray(domElement);

  if (window.trudonGlobals) {
    elementDetails.currentElementGrade = window.trudonGlobals.selectorOptionsHelpers.getFinalGradeForElement(domElement, elementDetails);
  }

  return elementDetails;
};

var getDirectDetails = function getDirectDetails(element) {
  var withTextContent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
  return {
    tag: element.tagName,
    textContent: withTextContent && element.textContent ? element.textContent.replace(/[\n\r\s]+/g, '').substring(0, 128) : null,
    // trim to 128 characters and delete white spaces tabs and new lines
    numberOfPreviousSiblings: getPreviousSiblingsNumber(element),
    numberOfAfterSiblings: getNextSiblingsNumber(element),
    attributes: getAllAttributes(element)
  };
};

var getNextSiblingsNumber = function getNextSiblingsNumber(element) {
  var nextSiblings = 0;

  while (element.nextElementSibling && nextSiblings < 100) {
    if (element.nodeType === 3) {
      continue; // text node not included in nextElementSibling
    }

    element = element.nextElementSibling;
    nextSiblings += 1;
  }

  return nextSiblings;
};

var getPreviousSiblingsNumber = function getPreviousSiblingsNumber(element) {
  var previousSiblings = 0;

  while (element.previousElementSibling && previousSiblings < 100) {
    if (element.nodeType === 3) {
      continue; // text node not included in previousElementSibling
    }

    element = element.previousElementSibling;
    previousSiblings += 1;
  }

  return previousSiblings;
};

var addToGlobalVariable = function addToGlobalVariable(testLineItemDetails) {
  var elementDetails = constructElementDetails(testLineItemDetails.selector, testLineItemDetails.testLineItemId);

  if (window.trudonGlobals) {
    window.trudonGlobals.elementDetails.push(elementDetails);
  }

  return elementDetails;
};

var attachElementDetailsToGlobal = function attachElementDetailsToGlobal() {
  if (window.trudonGlobals) {
    return addToGlobalVariable(window.trudonGlobals.element);
  }
};

var _default = {
  attachElementDetailsToGlobal: attachElementDetailsToGlobal,
  constructElementDetails: constructElementDetails
};
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVsZW1lbnQtZGV0YWlscy1oZWxwZXIuanMiXSwibmFtZXMiOlsiZ2V0QWxsQXR0cmlidXRlcyIsImVsZW1lbnQiLCJhdHRyaWJ1dGVEZXRhaWxzIiwiYXR0cmlidXRlcyIsIkFycmF5IiwicHJvdG90eXBlIiwic2xpY2UiLCJjYWxsIiwiZm9yRWFjaCIsImF0dHJpYnV0ZSIsIm5vZGVOYW1lIiwibm9kZVZhbHVlIiwiY29uc3RydWN0UGFyZW50c0FycmF5IiwicGFyZW50QXJyYXkiLCJpbmRleCIsInBhcmVudEVsZW1lbnQiLCJwdXNoIiwiZ2V0RGlyZWN0RGV0YWlscyIsImNvbnN0cnVjdERpcmVjdENoaWxkcmVuQXJyYXkiLCJjaGlsZHJlbkFycmF5IiwiY2hpbGRyZW4iLCJjaGlsZCIsImRldGFpbHMiLCJjb25zdHJ1Y3RFbGVtZW50RGV0YWlscyIsInNlbGVjdG9yIiwidGVzdExpbmVJdGVtSWQiLCJyZXF1ZXN0ZWRCeUV4dGVuc2lvbiIsImRvbUVsZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ3aW5kb3ciLCJ0cnVkb25HbG9iYWxzIiwiZWxlbWVudERldGFpbHMiLCJuZXh0U2libGluZyIsIm5leHRFbGVtZW50U2libGluZyIsInByZXZpb3VzU2libGluZyIsInByZXZpb3VzRWxlbWVudFNpYmxpbmciLCJwYXJlbnRzIiwiY3VycmVudEVsZW1lbnRHcmFkZSIsInNlbGVjdG9yT3B0aW9uc0hlbHBlcnMiLCJnZXRGaW5hbEdyYWRlRm9yRWxlbWVudCIsIndpdGhUZXh0Q29udGVudCIsInRhZyIsInRhZ05hbWUiLCJ0ZXh0Q29udGVudCIsInJlcGxhY2UiLCJzdWJzdHJpbmciLCJudW1iZXJPZlByZXZpb3VzU2libGluZ3MiLCJnZXRQcmV2aW91c1NpYmxpbmdzTnVtYmVyIiwibnVtYmVyT2ZBZnRlclNpYmxpbmdzIiwiZ2V0TmV4dFNpYmxpbmdzTnVtYmVyIiwibmV4dFNpYmxpbmdzIiwibm9kZVR5cGUiLCJwcmV2aW91c1NpYmxpbmdzIiwiYWRkVG9HbG9iYWxWYXJpYWJsZSIsInRlc3RMaW5lSXRlbURldGFpbHMiLCJhdHRhY2hFbGVtZW50RGV0YWlsc1RvR2xvYmFsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsSUFBSUEsZ0JBQWdCLEdBQUcsU0FBbkJBLGdCQUFtQixDQUFVQyxPQUFWLEVBQW1CO0FBQ3hDLE1BQUlDLGdCQUFnQixHQUFHLEVBQXZCOztBQUVBLE1BQUksQ0FBQ0QsT0FBTyxDQUFDRSxVQUFiLEVBQXlCO0FBQ3ZCLFdBQU8sRUFBUDtBQUNEOztBQUVELE1BQUlBLFVBQVUsR0FBR0MsS0FBSyxDQUFDQyxTQUFOLENBQWdCQyxLQUFoQixDQUFzQkMsSUFBdEIsQ0FBMkJOLE9BQU8sQ0FBQ0UsVUFBbkMsQ0FBakI7QUFDQUEsRUFBQUEsVUFBVSxDQUFDSyxPQUFYLENBQW1CLFVBQVVDLFNBQVYsRUFBcUI7QUFDdENQLElBQUFBLGdCQUFnQixDQUFDTyxTQUFTLENBQUNDLFFBQVgsQ0FBaEIsR0FBdUNELFNBQVMsQ0FBQ0UsU0FBakQ7QUFDRCxHQUZEO0FBSUEsU0FBT1QsZ0JBQVA7QUFDRCxDQWJEOztBQWVBLElBQUlVLHFCQUFxQixHQUFHLFNBQXhCQSxxQkFBd0IsQ0FBVVgsT0FBVixFQUFtQjtBQUM3QyxNQUFJWSxXQUFXLEdBQUcsRUFBbEI7QUFDQSxNQUFJQyxLQUFLLEdBQUcsQ0FBWjs7QUFFQSxNQUFJLENBQUNiLE9BQU8sQ0FBQ2MsYUFBYixFQUE0QjtBQUMxQixXQUFPRixXQUFQO0FBQ0Q7O0FBRURaLEVBQUFBLE9BQU8sR0FBR0EsT0FBTyxDQUFDYyxhQUFsQjs7QUFFQSxTQUFPZCxPQUFPLEtBQUssSUFBWixJQUFvQmEsS0FBSyxHQUFHLEVBQW5DLEVBQXVDO0FBQ3JDQSxJQUFBQSxLQUFLLElBQUksQ0FBVDtBQUNBRCxJQUFBQSxXQUFXLENBQUNHLElBQVosQ0FBaUJDLGdCQUFnQixDQUFDaEIsT0FBRCxDQUFqQztBQUVBQSxJQUFBQSxPQUFPLEdBQUdBLE9BQU8sQ0FBQ2MsYUFBbEI7QUFDRDs7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OztBQUNBLE1BQUlLLE1BQU0sQ0FBQ0MsYUFBWCxFQUEwQjtBQUN4QkQsSUFBQUEsTUFBTSxDQUFDQyxhQUFQLENBQXFCQyxjQUFyQixDQUFvQ2hCLElBQXBDLENBQXlDZ0IsY0FBekM7QUFDRDs7QUFFRCxTQUFPQSxjQUFQO0FBQ0QsQ0FQRDs7QUFTQSxJQUFJd0IsNEJBQTRCLEdBQUcsU0FBL0JBLDRCQUErQixHQUFNO0FBQ3ZDLE1BQUkxQixNQUFNLENBQUNDLGFBQVgsRUFBMEI7QUFDeEIsV0FBT3VCLG1CQUFtQixDQUFDeEIsTUFBTSxDQUFDQyxhQUFQLENBQXFCOUIsT0FBdEIsQ0FBMUI7QUFDRDtBQUNGLENBSkQ7O2VBTWU7QUFDYnVELEVBQUFBLDRCQUE0QixFQUE1QkEsNEJBRGE7QUFFYmpDLEVBQUFBLHVCQUF1QixFQUF2QkE7QUFGYSxDIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGdldEFsbEF0dHJpYnV0ZXMgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICB2YXIgYXR0cmlidXRlRGV0YWlscyA9IHt9O1xuXG4gIGlmICghZWxlbWVudC5hdHRyaWJ1dGVzKSB7XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgdmFyIGF0dHJpYnV0ZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChlbGVtZW50LmF0dHJpYnV0ZXMpO1xuICBhdHRyaWJ1dGVzLmZvckVhY2goZnVuY3Rpb24gKGF0dHJpYnV0ZSkge1xuICAgIGF0dHJpYnV0ZURldGFpbHNbYXR0cmlidXRlLm5vZGVOYW1lXSA9IGF0dHJpYnV0ZS5ub2RlVmFsdWU7XG4gIH0pO1xuXG4gIHJldHVybiBhdHRyaWJ1dGVEZXRhaWxzO1xufTtcblxudmFyIGNvbnN0cnVjdFBhcmVudHNBcnJheSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gIHZhciBwYXJlbnRBcnJheSA9IFtdO1xuICB2YXIgaW5kZXggPSAwO1xuXG4gIGlmICghZWxlbWVudC5wYXJlbnRFbGVtZW50KSB7XG4gICAgcmV0dXJuIHBhcmVudEFycmF5O1xuICB9XG5cbiAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50RWxlbWVudDtcblxuICB3aGlsZSAoZWxlbWVudCAhPT0gbnVsbCAmJiBpbmRleCA8IDEwKSB7XG4gICAgaW5kZXggKz0gMTtcbiAgICBwYXJlbnRBcnJheS5wdXNoKGdldERpcmVjdERldGFpbHMoZWxlbWVudCkpO1xuXG4gICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgfVxuXG4gIHJldHVybiBwYXJlbnRBcnJheTtcbn07XG5cbnZhciBjb25zdHJ1Y3REaXJlY3RDaGlsZHJlbkFycmF5ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgdmFyIGNoaWxkcmVuQXJyYXkgPSBbXTtcblxuICBpZiAoIWVsZW1lbnQuY2hpbGRyZW4pIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHZhciBjaGlsZHJlbiA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGVsZW1lbnQuY2hpbGRyZW4pO1xuXG4gIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgY2hpbGRyZW5BcnJheS5wdXNoKHtcbiAgICAgIGRldGFpbHM6IGdldERpcmVjdERldGFpbHMoY2hpbGQpLFxuICAgICAgY2hpbGRyZW46IGNvbnN0cnVjdERpcmVjdENoaWxkcmVuQXJyYXkoY2hpbGQpLFxuICAgIH0pO1xuICB9KTtcblxuICByZXR1cm4gY2hpbGRyZW5BcnJheTtcbn07XG5cbnZhciBjb25zdHJ1Y3RFbGVtZW50RGV0YWlscyA9IGZ1bmN0aW9uIChzZWxlY3RvciwgdGVzdExpbmVJdGVtSWQsIHJlcXVlc3RlZEJ5RXh0ZW5zaW9uID0gZmFsc2UpIHtcbiAgdmFyIGRvbUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcblxuICBpZiAoIWRvbUVsZW1lbnQgfHwgKCF3aW5kb3cudHJ1ZG9uR2xvYmFscyAmJiAhcmVxdWVzdGVkQnlFeHRlbnNpb24pKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICB2YXIgZWxlbWVudERldGFpbHMgPSBnZXREaXJlY3REZXRhaWxzKGRvbUVsZW1lbnQpO1xuICBpZiAodGVzdExpbmVJdGVtSWQpIHtcbiAgICBlbGVtZW50RGV0YWlscy50ZXN0TGluZUl0ZW1JZCA9IHRlc3RMaW5lSXRlbUlkO1xuICB9XG4gIGVsZW1lbnREZXRhaWxzLnNlbGVjdG9yID0gc2VsZWN0b3I7XG4gIGVsZW1lbnREZXRhaWxzLm5leHRTaWJsaW5nID0gZG9tRWxlbWVudC5uZXh0RWxlbWVudFNpYmxpbmcgPyBnZXREaXJlY3REZXRhaWxzKGRvbUVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nKSA6IG51bGw7XG4gIGVsZW1lbnREZXRhaWxzLnByZXZpb3VzU2libGluZyA9IGRvbUVsZW1lbnQucHJldmlvdXNFbGVtZW50U2libGluZyA/IGdldERpcmVjdERldGFpbHMoZG9tRWxlbWVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nKSA6IG51bGw7XG4gIGVsZW1lbnREZXRhaWxzLnBhcmVudHMgPSBjb25zdHJ1Y3RQYXJlbnRzQXJyYXkoZG9tRWxlbWVudCk7XG4gIGVsZW1lbnREZXRhaWxzLmNoaWxkcmVuID0gY29uc3RydWN0RGlyZWN0Q2hpbGRyZW5BcnJheShkb21FbGVtZW50KTtcbiAgaWYgKHdpbmRvdy50cnVkb25HbG9iYWxzKSB7XG4gICAgZWxlbWVudERldGFpbHMuY3VycmVudEVsZW1lbnRHcmFkZSA9IHdpbmRvdy50cnVkb25HbG9iYWxzLnNlbGVjdG9yT3B0aW9uc0hlbHBlcnMuZ2V0RmluYWxHcmFkZUZvckVsZW1lbnQoZG9tRWxlbWVudCwgZWxlbWVudERldGFpbHMpO1xuICB9XG5cbiAgcmV0dXJuIGVsZW1lbnREZXRhaWxzO1xufTtcblxudmFyIGdldERpcmVjdERldGFpbHMgPSBmdW5jdGlvbiAoZWxlbWVudCwgd2l0aFRleHRDb250ZW50ID0gdHJ1ZSkge1xuICByZXR1cm4ge1xuICAgIHRhZzogZWxlbWVudC50YWdOYW1lLFxuICAgIHRleHRDb250ZW50OiB3aXRoVGV4dENvbnRlbnQgJiYgZWxlbWVudC50ZXh0Q29udGVudCA/IGVsZW1lbnQudGV4dENvbnRlbnQucmVwbGFjZSgvW1xcblxcclxcc10rL2csICcnKS5zdWJzdHJpbmcoMCwgMTI4KSA6IG51bGwsIC8vIHRyaW0gdG8gMTI4IGNoYXJhY3RlcnMgYW5kIGRlbGV0ZSB3aGl0ZSBzcGFjZXMgdGFicyBhbmQgbmV3IGxpbmVzXG4gICAgbnVtYmVyT2ZQcmV2aW91c1NpYmxpbmdzOiBnZXRQcmV2aW91c1NpYmxpbmdzTnVtYmVyKGVsZW1lbnQpLFxuICAgIG51bWJlck9mQWZ0ZXJTaWJsaW5nczogZ2V0TmV4dFNpYmxpbmdzTnVtYmVyKGVsZW1lbnQpLFxuICAgIGF0dHJpYnV0ZXM6IGdldEFsbEF0dHJpYnV0ZXMoZWxlbWVudCksXG4gIH07XG59O1xuXG52YXIgZ2V0TmV4dFNpYmxpbmdzTnVtYmVyID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgdmFyIG5leHRTaWJsaW5ncyA9IDA7XG5cbiAgd2hpbGUgKGVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nICYmIG5leHRTaWJsaW5ncyA8IDEwMCkge1xuICAgIGlmIChlbGVtZW50Lm5vZGVUeXBlID09PSAzKSB7XG4gICAgICBjb250aW51ZTsgLy8gdGV4dCBub2RlIG5vdCBpbmNsdWRlZCBpbiBuZXh0RWxlbWVudFNpYmxpbmdcbiAgICB9XG4gICAgZWxlbWVudCA9IGVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nO1xuXG4gICAgbmV4dFNpYmxpbmdzICs9IDE7XG4gIH1cblxuICByZXR1cm4gbmV4dFNpYmxpbmdzO1xufTtcblxudmFyIGdldFByZXZpb3VzU2libGluZ3NOdW1iZXIgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICB2YXIgcHJldmlvdXNTaWJsaW5ncyA9IDA7XG5cbiAgd2hpbGUgKGVsZW1lbnQucHJldmlvdXNFbGVtZW50U2libGluZyAmJiBwcmV2aW91c1NpYmxpbmdzIDwgMTAwKSB7XG4gICAgaWYgKGVsZW1lbnQubm9kZVR5cGUgPT09IDMpIHtcbiAgICAgIGNvbnRpbnVlOyAvLyB0ZXh0IG5vZGUgbm90IGluY2x1ZGVkIGluIHByZXZpb3VzRWxlbWVudFNpYmxpbmdcbiAgICB9XG4gICAgZWxlbWVudCA9IGVsZW1lbnQucHJldmlvdXNFbGVtZW50U2libGluZztcblxuICAgIHByZXZpb3VzU2libGluZ3MgKz0gMTtcbiAgfVxuXG4gIHJldHVybiBwcmV2aW91c1NpYmxpbmdzO1xufTtcblxudmFyIGFkZFRvR2xvYmFsVmFyaWFibGUgPSBmdW5jdGlvbiAodGVzdExpbmVJdGVtRGV0YWlscykge1xuICB2YXIgZWxlbWVudERldGFpbHMgPSBjb25zdHJ1Y3RFbGVtZW50RGV0YWlscyh0ZXN0TGluZUl0ZW1EZXRhaWxzLnNlbGVjdG9yLCB0ZXN0TGluZUl0ZW1EZXRhaWxzLnRlc3RMaW5lSXRlbUlkKTtcbiAgaWYgKHdpbmRvdy50cnVkb25HbG9iYWxzKSB7XG4gICAgd2luZG93LnRydWRvbkdsb2JhbHMuZWxlbWVudERldGFpbHMucHVzaChlbGVtZW50RGV0YWlscyk7XG4gIH1cblxuICByZXR1cm4gZWxlbWVudERldGFpbHM7XG59O1xuXG52YXIgYXR0YWNoRWxlbWVudERldGFpbHNUb0dsb2JhbCA9ICgpID0+IHtcbiAgaWYgKHdpbmRvdy50cnVkb25HbG9iYWxzKSB7XG4gICAgcmV0dXJuIGFkZFRvR2xvYmFsVmFyaWFibGUod2luZG93LnRydWRvbkdsb2JhbHMuZWxlbWVudCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBhdHRhY2hFbGVtZW50RGV0YWlsc1RvR2xvYmFsLFxuICBjb25zdHJ1Y3RFbGVtZW50RGV0YWlscyxcbn07XG4iXSwiZmlsZSI6ImVsZW1lbnQtZGV0YWlscy1oZWxwZXIuanMifQ==
