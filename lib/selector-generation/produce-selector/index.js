"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getSelector = getSelector;
exports["default"] = exports.produceSelector = void 0;

var _jquery = _interopRequireDefault(require("jquery"));

var _select = _interopRequireWildcard(require("../../select"));

var _selectorConfiguration = _interopRequireDefault(require("../selector-configuration"));

var _selectWrapper = _interopRequireDefault(require("./select-wrapper"));

var _exceptionsHelper = require("./exceptions-helper");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var defaultSelectorConfig = new _selectorConfiguration["default"]('Default Selector Configuration');
/**
 * Produces the selector and uses fallbacks in case the current config
 * is too restrictive for the current element
 * @param {JQuery} $element
 * @param {Object} $customPageDocument
 * @param {SelectorConfig} config
 * @return {Object}
 */

function produceSelectorFn($element, $customPageDocument, config) {
  // try with the specified config and default strategy
  var sel1 = (0, _selectWrapper["default"])($element, $customPageDocument, config, _select["default"]);

  if (!sel1.hasError) {
    return sel1;
  } // try with the fallback config and default strategy


  var sel2 = (0, _selectWrapper["default"])($element, $customPageDocument, null, _select["default"]);

  if (!defaultSelectorConfig.isIncludedInConfig(config)) {
    (0, _exceptionsHelper.addWarningMessage)(sel2, _exceptionsHelper.WARNINGS.FELL_TO_DEFAULT_CONFIG);
  }

  if (!sel2.hasError) {
    return sel2;
  } // try with the specified config and the fallback strategy


  var sel3 = (0, _selectWrapper["default"])($element, $customPageDocument, config, _select.getSingleSelector);
  (0, _exceptionsHelper.addWarningMessage)(sel3, _exceptionsHelper.WARNINGS.FELL_TO_DEFAULT_STRATEGY);

  if (!sel3.hasError) {
    return sel3;
  } // try with the fallback config and the fallback strategy


  var sel4 = (0, _selectWrapper["default"])($element, $customPageDocument, null, _select.getSingleSelector);

  if (!defaultSelectorConfig.isIncludedInConfig(config)) {
    (0, _exceptionsHelper.addWarningMessage)(sel4, _exceptionsHelper.WARNINGS.FELL_TO_DEFAULT_CONFIG);
  }

  (0, _exceptionsHelper.addWarningMessage)(sel4, _exceptionsHelper.WARNINGS.FELL_TO_DEFAULT_STRATEGY);

  if (!sel4.hasError) {
    return sel4;
  } // try with tags only config and defaultStrategy


  var tagsOnlyComposition = {
    classes: false,
    ids: false,
    tags: true,
    attributes: false,
    exceptions: Object.assign({}, {
      forbiddenClassSubstrings: config.getForbiddenClassSubstrings()
    }, {
      forbiddenIdSubstrings: config.getForbiddenIdSubstrings()
    }, {
      forbiddenAttributeSubstrings: config.getForbiddenAttributeSubstrings()
    })
  };
  var configTagsOnly = new _selectorConfiguration["default"](config.name, tagsOnlyComposition);
  var sel5 = (0, _selectWrapper["default"])($element, $customPageDocument, configTagsOnly, _select["default"]);

  if (!configTagsOnly.isIncludedInConfig(config)) {
    (0, _exceptionsHelper.addWarningMessage)(sel5, _exceptionsHelper.WARNINGS.FELL_TO_DEFAULT_CONFIG);
  }

  if (!sel5.hasError) {
    return sel5;
  }

  logAllInvalidSelectorsError(sel1, sel2, sel3, sel4, sel5);
  return null;
}

function logAllInvalidSelectorsError(sel1, sel2, sel3, sel4, sel5) {
  console.error('All produce selector attempts failed. The selectors are:');
  console.error('userConfig + defaultStrategy', sel1);
  console.error('fallbackConfig + defaultStrategy', sel2);
  console.error('userConfig + fallbackStrategy', sel3);
  console.error('fallbackConfig + fallbackStrategy', sel4);
  console.error('tagsOnlyComposition + defaultStrategy', sel5);
}

function produceSelectorFnWrapper($element, $customPageDocument, config) {
  var selector = produceSelectorFn($element, $customPageDocument, config);

  if (selector == null) {
    return console.error('Selector is null!');
  }

  if (selector.hasError) {
    console.error('Selector with errors: ', selector.errors);
  }

  if (selector.hasWarning) {
    console.warn('Selector with warnings: ', selector.warnings);
  }

  return selector;
}
/**
* Produces a selector without needing jquery element as param or
* an instance of SelectorConfig(useful for algotech-testing-runner)
*
* @param {HTMLElement}      element
* @param {Object}           config
* @return {string}
*/


function getSelector(element, config) {
  var selectorConfig = new _selectorConfiguration["default"]('Global Selector Config', config);
  return produceSelectorFnWrapper((0, _jquery["default"])(element), null, selectorConfig);
}

var produceSelector = produceSelectorFnWrapper;
exports.produceSelector = produceSelector;
var _default = {
  produceSelector: produceSelectorFnWrapper
};
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlbGVjdG9yLWdlbmVyYXRpb24vcHJvZHVjZS1zZWxlY3Rvci9pbmRleC5qcyJdLCJuYW1lcyI6WyJkZWZhdWx0U2VsZWN0b3JDb25maWciLCJTZWxlY3RvckNvbmZpZyIsInByb2R1Y2VTZWxlY3RvckZuIiwiJGVsZW1lbnQiLCIkY3VzdG9tUGFnZURvY3VtZW50IiwiY29uZmlnIiwic2VsMSIsImdldFF1ZXJ5U2VsZWN0b3IiLCJoYXNFcnJvciIsInNlbDIiLCJpc0luY2x1ZGVkSW5Db25maWciLCJXQVJOSU5HUyIsIkZFTExfVE9fREVGQVVMVF9DT05GSUciLCJzZWwzIiwiZ2V0U2luZ2xlU2VsZWN0b3IiLCJGRUxMX1RPX0RFRkFVTFRfU1RSQVRFR1kiLCJzZWw0IiwidGFnc09ubHlDb21wb3NpdGlvbiIsImNsYXNzZXMiLCJpZHMiLCJ0YWdzIiwiYXR0cmlidXRlcyIsImV4Y2VwdGlvbnMiLCJPYmplY3QiLCJhc3NpZ24iLCJmb3JiaWRkZW5DbGFzc1N1YnN0cmluZ3MiLCJnZXRGb3JiaWRkZW5DbGFzc1N1YnN0cmluZ3MiLCJmb3JiaWRkZW5JZFN1YnN0cmluZ3MiLCJnZXRGb3JiaWRkZW5JZFN1YnN0cmluZ3MiLCJmb3JiaWRkZW5BdHRyaWJ1dGVTdWJzdHJpbmdzIiwiZ2V0Rm9yYmlkZGVuQXR0cmlidXRlU3Vic3RyaW5ncyIsImNvbmZpZ1RhZ3NPbmx5IiwibmFtZSIsInNlbDUiLCJsb2dBbGxJbnZhbGlkU2VsZWN0b3JzRXJyb3IiLCJjb25zb2xlIiwiZXJyb3IiLCJwcm9kdWNlU2VsZWN0b3JGbldyYXBwZXIiLCJzZWxlY3RvciIsImVycm9ycyIsImhhc1dhcm5pbmciLCJ3YXJuIiwid2FybmluZ3MiLCJnZXRTZWxlY3RvciIsImVsZW1lbnQiLCJzZWxlY3RvckNvbmZpZyIsInByb2R1Y2VTZWxlY3RvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOzs7Ozs7OztBQUVBLElBQU1BLHFCQUFx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LFFBQVA7QUFDRDtBQUVEOzs7Ozs7Ozs7O0FBUU8sU0FBU0ssV0FBVCxDQUFxQkMsT0FBckIsRUFBOEJ2QyxNQUE5QixFQUFzQztBQUMzQyxNQUFNd0MsY0FBYyxHQUFHLElBQUk1QyxpQ0FBSixDQUFtQix3QkFBbkIsRUFBNkNJLE1BQTdDLENBQXZCO0FBRUEsU0FBT2dDLHdCQUF3QixDQUFDLHdCQUFFTyxPQUFGLENBQUQsRUFBYSxJQUFiLEVBQW1CQyxjQUFuQixDQUEvQjtBQUNEOztBQUVNLElBQU1DLGVBQWUsR0FBR1Qsd0JBQXhCOztlQUVRO0FBQ2JTLEVBQUFBLGVBQWUsRUFBRVQ7QUFESixDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICQgZnJvbSAnanF1ZXJ5JztcbmltcG9ydCBnZXRRdWVyeVNlbGVjdG9yLCB7IGdldFNpbmdsZVNlbGVjdG9yIH0gZnJvbSAnLi4vLi4vc2VsZWN0JztcblxuaW1wb3J0IFNlbGVjdG9yQ29uZmlnIGZyb20gJy4uL3NlbGVjdG9yLWNvbmZpZ3VyYXRpb24nO1xuaW1wb3J0IHNlbGVjdCBmcm9tICcuL3NlbGVjdC13cmFwcGVyJztcbmltcG9ydCB7IGFkZFdhcm5pbmdNZXNzYWdlLCBXQVJOSU5HUyB9IGZyb20gJy4vZXhjZXB0aW9ucy1oZWxwZXInO1xuXG5jb25zdCBkZWZhdWx0U2VsZWN0b3JDb25maWcgPSBuZXcgU2VsZWN0b3JDb25maWcoXG4gICdEZWZhdWx0IFNlbGVjdG9yIENvbmZpZ3VyYXRpb24nXG4pO1xuXG4vKipcbiAqIFByb2R1Y2VzIHRoZSBzZWxlY3RvciBhbmQgdXNlcyBmYWxsYmFja3MgaW4gY2FzZSB0aGUgY3VycmVudCBjb25maWdcbiAqIGlzIHRvbyByZXN0cmljdGl2ZSBmb3IgdGhlIGN1cnJlbnQgZWxlbWVudFxuICogQHBhcmFtIHtKUXVlcnl9ICRlbGVtZW50XG4gKiBAcGFyYW0ge09iamVjdH0gJGN1c3RvbVBhZ2VEb2N1bWVudFxuICogQHBhcmFtIHtTZWxlY3RvckNvbmZpZ30gY29uZmlnXG4gKiBAcmV0dXJuIHtPYmplY3R9XG4gKi9cbmZ1bmN0aW9uIHByb2R1Y2VTZWxlY3RvckZuKCRlbGVtZW50LCAkY3VzdG9tUGFnZURvY3VtZW50LCBjb25maWcpIHtcbiAgLy8gdHJ5IHdpdGggdGhlIHNwZWNpZmllZCBjb25maWcgYW5kIGRlZmF1bHQgc3RyYXRlZ3lcbiAgbGV0IHNlbDEgPSBzZWxlY3QoJGVsZW1lbnQsICRjdXN0b21QYWdlRG9jdW1lbnQsIGNvbmZpZywgZ2V0UXVlcnlTZWxlY3Rvcik7XG5cbiAgaWYgKCFzZWwxLmhhc0Vycm9yKSB7XG4gICAgcmV0dXJuIHNlbDE7XG4gIH1cblxuICAvLyB0cnkgd2l0aCB0aGUgZmFsbGJhY2sgY29uZmlnIGFuZCBkZWZhdWx0IHN0cmF0ZWd5XG4gIGxldCBzZWwyID0gc2VsZWN0KCRlbGVtZW50LCAkY3VzdG9tUGFnZURvY3VtZW50LCBudWxsLCBnZXRRdWVyeVNlbGVjdG9yKTtcblxuICBpZiAoIWRlZmF1bHRTZWxlY3RvckNvbmZpZy5pc0luY2x1ZGVkSW5Db25maWcoY29uZmlnKSkge1xuICAgIGFkZFdhcm5pbmdNZXNzYWdlKHNlbDIsIFdBUk5JTkdTLkZFTExfVE9fREVGQVVMVF9DT05GSUcpO1xuICB9XG5cbiAgaWYgKCFzZWwyLmhhc0Vycm9yKSB7XG4gICAgcmV0dXJuIHNlbDI7XG4gIH1cblxuICAvLyB0cnkgd2l0aCB0aGUgc3BlY2lmaWVkIGNvbmZpZyBhbmQgdGhlIGZhbGxiYWNrIHN0cmF0ZWd5XG4gIGxldCBzZWwzID0gc2VsZWN0KCRlbGVtZW50LCAkY3VzdG9tUGFnZURvY3VtZW50LCBjb25maWcsIGdldFNpbmdsZVNlbGVjdG9yKTtcblxuICBhZGRXYXJuaW5nTWVzc2FnZShzZWwzLCBXQVJOSU5HUy5GRUxMX1RPX0RFRkFVTFRfU1RSQVRFR1kpO1xuXG4gIGlmICghc2VsMy5oYXNFcnJvcikge1xuICAgIHJldHVybiBzZWwzO1xuICB9XG5cbiAgLy8gdHJ5IHdpdGggdGhlIGZhbGxiYWNrIGNvbmZpZyBhbmQgdGhlIGZhbGxiYWNrIHN0cmF0ZWd5XG4gIGxldCBzZWw0ID0gc2VsZWN0KCRlbGVtZW50LCAkY3VzdG9tUGFnZURvY3VtZW50LCBudWxsLCBnZXRTaW5nbGVTZWxlY3Rvcik7XG5cbiAgaWYgKCFkZWZhdWx0U2VsZWN0b3JDb25maWcuaXNJbmNsdWRlZEluQ29uZmlnKGNvbmZpZykpIHtcbiAgICBhZGRXYXJuaW5nTWVzc2FnZShzZWw0LCBXQVJOSU5HUy5GRUxMX1RPX0RFRkFVTFRfQ09ORklHKTtcbiAgfVxuICBhZGRXYXJuaW5nTWVzc2FnZShzZWw0LCBXQVJOSU5HUy5GRUxMX1RPX0RFRkFVTFRfU1RSQVRFR1kpO1xuXG4gIGlmICghc2VsNC5oYXNFcnJvcikge1xuICAgIHJldHVybiBzZWw0O1xuICB9XG5cbiAgLy8gdHJ5IHdpdGggdGFncyBvbmx5IGNvbmZpZyBhbmQgZGVmYXVsdFN0cmF0ZWd5XG4gIGxldCB0YWdzT25seUNvbXBvc2l0aW9uID0ge1xuICAgIGNsYXNzZXM6IGZhbHNlLFxuICAgIGlkczogZmFsc2UsXG4gICAgdGFnczogdHJ1ZSxcbiAgICBhdHRyaWJ1dGVzOiBmYWxzZSxcbiAgICBleGNlcHRpb25zOiBPYmplY3QuYXNzaWduKFxuICAgICAge30sXG4gICAgICB7IGZvcmJpZGRlbkNsYXNzU3Vic3RyaW5nczogY29uZmlnLmdldEZvcmJpZGRlbkNsYXNzU3Vic3RyaW5ncygpIH0sXG4gICAgICB7IGZvcmJpZGRlbklkU3Vic3RyaW5nczogY29uZmlnLmdldEZvcmJpZGRlbklkU3Vic3RyaW5ncygpIH0sXG4gICAgICB7IGZvcmJpZGRlbkF0dHJpYnV0ZVN1YnN0cmluZ3M6IGNvbmZpZy5nZXRGb3JiaWRkZW5BdHRyaWJ1dGVTdWJzdHJpbmdzKCkgfVxuICAgIClcbiAgfTtcbiAgbGV0IGNvbmZpZ1RhZ3NPbmx5ID0gbmV3IFNlbGVjdG9yQ29uZmlnKGNvbmZpZy5uYW1lLCB0YWdzT25seUNvbXBvc2l0aW9uKTtcbiAgbGV0IHNlbDUgPVxuICAgIHNlbGVjdCgkZWxlbWVudCwgJGN1c3RvbVBhZ2VEb2N1bWVudCwgY29uZmlnVGFnc09ubHksIGdldFF1ZXJ5U2VsZWN0b3IpO1xuXG4gIGlmICghY29uZmlnVGFnc09ubHkuaXNJbmNsdWRlZEluQ29uZmlnKGNvbmZpZykpIHtcbiAgICBhZGRXYXJuaW5nTWVzc2FnZShzZWw1LCBXQVJOSU5HUy5GRUxMX1RPX0RFRkFVTFRfQ09ORklHKTtcbiAgfVxuXG4gIGlmICghc2VsNS5oYXNFcnJvcikge1xuICAgIHJldHVybiBzZWw1O1xuICB9XG5cbiAgbG9nQWxsSW52YWxpZFNlbGVjdG9yc0Vycm9yKHNlbDEsIHNlbDIsIHNlbDMsIHNlbDQsIHNlbDUpO1xuXG4gIHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiBsb2dBbGxJbnZhbGlkU2VsZWN0b3JzRXJyb3Ioc2VsMSwgc2VsMiwgc2VsMywgc2VsNCwgc2VsNSkge1xuICBjb25zb2xlLmVycm9yKCdBbGwgcHJvZHVjZSBzZWxlY3RvciBhdHRlbXB0cyBmYWlsZWQuIFRoZSBzZWxlY3RvcnMgYXJlOicpO1xuICBjb25zb2xlLmVycm9yKCd1c2VyQ29uZmlnICsgZGVmYXVsdFN0cmF0ZWd5Jywgc2VsMSk7XG4gIGNvbnNvbGUuZXJyb3IoJ2ZhbGxiYWNrQ29uZmlnICsgZGVmYXVsdFN0cmF0ZWd5Jywgc2VsMik7XG4gIGNvbnNvbGUuZXJyb3IoJ3VzZXJDb25maWcgKyBmYWxsYmFja1N0cmF0ZWd5Jywgc2VsMyk7XG4gIGNvbnNvbGUuZXJyb3IoJ2ZhbGxiYWNrQ29uZmlnICsgZmFsbGJhY2tTdHJhdGVneScsIHNlbDQpO1xuICBjb25zb2xlLmVycm9yKCd0YWdzT25seUNvbXBvc2l0aW9uICsgZGVmYXVsdFN0cmF0ZWd5Jywgc2VsNSk7XG59XG5cbmZ1bmN0aW9uIHByb2R1Y2VTZWxlY3RvckZuV3JhcHBlcigkZWxlbWVudCwgJGN1c3RvbVBhZ2VEb2N1bWVudCwgY29uZmlnKSB7XG4gIGxldCBzZWxlY3RvciA9IHByb2R1Y2VTZWxlY3RvckZuKCRlbGVtZW50LCAkY3VzdG9tUGFnZURvY3VtZW50LCBjb25maWcpO1xuXG4gIGlmIChzZWxlY3RvciA9PSBudWxsKSB7XG4gICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoJ1NlbGVjdG9yIGlzIG51bGwhJyk7XG4gIH1cbiAgaWYgKHNlbGVjdG9yLmhhc0Vycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignU2VsZWN0b3Igd2l0aCBlcnJvcnM6ICcsIHNlbGVjdG9yLmVycm9ycyk7XG4gIH1cbiAgaWYgKHNlbGVjdG9yLmhhc1dhcm5pbmcpIHtcbiAgICBjb25zb2xlLndhcm4oJ1NlbGVjdG9yIHdpdGggd2FybmluZ3M6ICcsIHNlbGVjdG9yLndhcm5pbmdzKTtcbiAgfVxuXG4gIHJldHVybiBzZWxlY3Rvcjtcbn1cblxuLyoqXG4qIFByb2R1Y2VzIGEgc2VsZWN0b3Igd2l0aG91dCBuZWVkaW5nIGpxdWVyeSBlbGVtZW50IGFzIHBhcmFtIG9yXG4qIGFuIGluc3RhbmNlIG9mIFNlbGVjdG9yQ29uZmlnKHVzZWZ1bCBmb3IgYWxnb3RlY2gtdGVzdGluZy1ydW5uZXIpXG4qXG4qIEBwYXJhbSB7SFRNTEVsZW1lbnR9ICAgICAgZWxlbWVudFxuKiBAcGFyYW0ge09iamVjdH0gICAgICAgICAgIGNvbmZpZ1xuKiBAcmV0dXJuIHtzdHJpbmd9XG4qL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNlbGVjdG9yKGVsZW1lbnQsIGNvbmZpZykge1xuICBjb25zdCBzZWxlY3RvckNvbmZpZyA9IG5ldyBTZWxlY3RvckNvbmZpZygnR2xvYmFsIFNlbGVjdG9yIENvbmZpZycsIGNvbmZpZyk7XG5cbiAgcmV0dXJuIHByb2R1Y2VTZWxlY3RvckZuV3JhcHBlcigkKGVsZW1lbnQpLCBudWxsLCBzZWxlY3RvckNvbmZpZyk7XG59XG5cbmV4cG9ydCBjb25zdCBwcm9kdWNlU2VsZWN0b3IgPSBwcm9kdWNlU2VsZWN0b3JGbldyYXBwZXI7XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgcHJvZHVjZVNlbGVjdG9yOiBwcm9kdWNlU2VsZWN0b3JGbldyYXBwZXJcbn07XG4iXSwiZmlsZSI6InNlbGVjdG9yLWdlbmVyYXRpb24vcHJvZHVjZS1zZWxlY3Rvci9pbmRleC5qcyJ9
