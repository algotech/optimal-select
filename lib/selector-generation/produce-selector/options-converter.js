"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.configToOptions = void 0;

var _relevanceHelper = require("./relevance-helper");

var _this = void 0;

/**
 * Transforms aSelectorConfig into optimal-select options
 * @param {SelectorConfig} selectorConfig
 * @return {Object}
 */
var configToOptions = function configToOptions(selectorConfig) {
  return {
    root: document,
    // define order of attribute processing
    priority: ['id', 'class'],
    // specify which attributes to ignore
    ignore: {
      id: ignoreIdFn.bind(_this, selectorConfig),
      "class": ignoreClassFn.bind(_this, selectorConfig),
      tag: ignoreTagFn.bind(_this, selectorConfig),
      attribute: ignoreAttributeFn.bind(_this, selectorConfig)
    }
  };
};
/**
 * Decides if ids should be used in selector generation
 * @param {SelectorConfig} selectorConfig
 * @param {string} a
 * @param {string} idName
 * @return {boolean}
 */


exports.configToOptions = configToOptions;

function ignoreIdFn(selectorConfig, a, idName) {
  if (selectorConfig.isAllowIds()) {
    if ((0, _relevanceHelper.isSelectorRandomlyGenerated)(idName) && selectorConfig.isExcludingRandomSelectors()) {
      return true;
    }

    return false; // allow all ids that reached this point
  }

  return true; // ignore all ids
}
/**
 * Decides if classes should be used in selector generation
 * @param {SelectorConfig} selectorConfig
 * @param {string} a
 * @param {string} className
 * @return {boolean}
 */


function ignoreClassFn(selectorConfig, a, className) {
  if (className && selectorConfig.isAllowClasses()) {
    if (className.length > 30) {
      return true; // ignore long classes
    }

    if ((0, _relevanceHelper.isSelectorRandomlyGenerated)(className) && selectorConfig.isExcludingRandomSelectors()) {
      return true;
    }

    var forbiddenSubstrings = selectorConfig.getForbiddenClassSubstrings();

    for (var i = 0; i < forbiddenSubstrings.length; i++) {
      if (className.includes(forbiddenSubstrings[i])) {
        return true; // ignore class name with forbidden substring
      }
    }

    return false; // don't ignore classes who reached until here
  }

  return true; // ignore all classes
}
/**
 * Decides if tags should be used in selector generation
 * @param {SelectorConfig} selectorConfig
 * @param {string} a
 * @param {string} tagName
 * @return {boolean}
 */


function ignoreTagFn(selectorConfig, a, tagName) {
  if (selectorConfig.isAllowTags()) {
    return false; // allow all tags
  }

  return true; // ignore all tags
}
/**
 * Decides if attributes should be used in selector generation
 * @param {SelectorConfig} selectorConfig
 * @param {string} attributeName
 * @param {string} attributeValue
 * @param {Function} defaultPredicate
 * @return {boolean}
 */


function ignoreAttributeFn(selectorConfig, attributeName, attributeValue, defaultPredicate) {
  if (selectorConfig.isAllowAttributes()) {
    if (((0, _relevanceHelper.isSelectorRandomlyGenerated)(attributeName) || (0, _relevanceHelper.isSelectorRandomlyGenerated)(attributeValue)) && selectorConfig.isExcludingRandomSelectors()) {
      return true;
    }

    var forbiddenSubstrings = selectorConfig.getForbiddenAttributeSubstrings();

    for (var i = 0; i < forbiddenSubstrings.length; i++) {
      if (attributeName.includes(forbiddenSubstrings[i])) {
        return true;
      }
    } // allow default attributes


    return defaultPredicate(attributeName, attributeValue);
  }

  return true; // ignore all attributes
}

var _default = {
  configToOptions: configToOptions
};
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlbGVjdG9yLWdlbmVyYXRpb24vcHJvZHVjZS1zZWxlY3Rvci9vcHRpb25zLWNvbnZlcnRlci5qcyJdLCJuYW1lcyI6WyJjb25maWdUb09wdGlvbnMiLCJzZWxlY3RvckNvbmZpZyIsInJvb3QiLCJkb2N1bWVudCIsInByaW9yaXR5IiwiaWdub3JlIiwiaWQiLCJpZ25vcmVJZEZuIiwiYmluZCIsImlnbm9yZUNsYXNzRm4iLCJ0YWciLCJpZ25vcmVUYWdGbiIsImF0dHJpYnV0ZSIsImlnbm9yZUF0dHJpYnV0ZUZuIiwiYSIsImlkTmFtZSIsImlzQWxsb3dJZHMiLCJpc0V4Y2x1ZGluZ1JhbmRvbVNlbGVjdG9ycyIsImNsYXNzTmFtZSIsImlzQWxsb3dDbGFzc2VzIiwibGVuZ3RoIiwiZm9yYmlkZGVuU3Vic3RyaW5ncyIsImdldEZvcmJpZGRlbkNsYXNzU3Vic3RyaW5ncyIsImkiLCJpbmNsdWRlcyIsInRhZ05hbWUiLCJpc0FsbG93VGFncyIsImF0dHJpYnV0ZU5hbWUiLCJhdHRyaWJ1dGVWYWx1ZSIsImRlZmF1bHRQcmVkaWNhdGUiLCJpc0FsbG93QXR0cmlidXRlcyIsImdldEZvcmJpZGRlbkF0dHJpYnV0ZVN1YnN0cmluZ3MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7OztBQUVBOzs7OztBQUtPLElBQU1BLGVBQWUsR0FBRyxTQUFsQkEsZUFBa0IsQ0FBQUMsY0FBYztBQUFBLFNBQUs7QUFDaERDLElBQUFBLElBQUksRUFBRUMsUUFEMEM7QUFFaEQ7QUFDQUMsSUFBQUEsUUFBUSxFQUFFLENBQUMsSUFBRCxFQUFPLE9BQVAsQ0FIc0M7QUFJaEQ7QUFDQUMsSUFBQUEsTUFBTSxFQUFFO0FBQ05DLE1BQUFBLEVBQUUsRUFBRUMsVUFBVSxDQUFDQyxJQUFYLENBQWdCLEtBQWhCLEVBQXNCUCxjQUF0QixDQURFO0FBRU4sZUFBT1EsYUFBYSxDQUFDRCxJQUFkLENBQW1CLEtBQW5CLEVBQXlCUCxjQUF6QixDQUZEO0FBR05TLE1BQUFBLEdBQUcsRUFBRUMsV0FBVyxDQUFDSCxJQUFaLENBQWlCLEtBQWpCLEVBQXVCUCxjQUF2QixDQUhDO0FBSU5XLE1BQUFBLFNBQVMsRUFBRUMsaUJBQWlCLENBQUNMLElBQWxCLENBQXVCLEtBQXZCLEVBQTZCUCxjQUE3QjtBQUpMO0FBTHdDLEdBQUw7QUFBQSxDQUF0QztBQWFQOzs7Ozs7Ozs7OztBQU9BLFNBQVNNLFVBQVQsQ0FBb0JOLGNBQXBCLEVBQW9DYSxDQUFwQyxFQUF1Q0MsTUFBdkMsRUFBK0M7QUFDN0MsTUFBSWQsY0FBYyxDQUFDZSxVQUFmLEVBQUosRUFBaUM7QUFDL0IsUUFBSSxrREFBNEJELE1BQTVCLEtBQXVDZCxjQUFjLENBQUNnQiwwQkFBZixFQUEzQyxFQUF3RjtBQUN0RixhQUFPLElBQVA7QUFDRDs7QUFFRCxXQUFPLEtBQVAsQ0FMK0IsQ0FLakI7QUFDZjs7QUFFRCxTQUFPLElBQVAsQ0FUNkMsQ0FTaEM7QUFDZDtBQUVEOzs7Ozs7Ozs7QUFPQSxTQUFTUixhQUFULENBQXVCUixjQUF2QixFQUF1Q2EsQ0FBdkMsRUFBMENJLFNBQTFDLEVBQXFEO0FBQ25ELE1BQUlBLFNBQVMsSUFBSWpCLGNBQWMsQ0FBQ2tCLGNBQWYsRUFBakIsRUFBa0Q7QUFDaEQsUUFBSUQsU0FBUyxDQUFDRSxNQUFWLEdBQW1CLEVBQXZCLEVBQTJCO0FBQ3pCLGFBQU8sSUFBUCxDQUR5QixDQUNaO0FBQ2Q7O0FBQ0QsUUFBSSxrREFBNEJGLFNBQTVCLEtBQTBDakIsY0FBYyxDQUFDZ0IsMEJBQWYsRUFBOUMsRUFBMkY7QUFDekYsYUFBTyxJQUFQO0FBQ0Q7O0FBQ0QsUUFBTUksbUJBQW1CLEdBQUdwQixjQUFjLENBQUNxQiwyQkFBZixFQUE1Qjs7QUFFQSxTQUFLLElBQUlDLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdGLG1CQUFtQixDQUFDRCxNQUF4QyxFQUFnREcsQ0FBQyxFQUFqRCxFQUFxRDtBQUNuRCxVQUFJTCxTQUFTLENBQUNNLFFBQVYsQ0FBbUJILG1CQUFtQixDQUFDRSxDQUFELENBQXRDLENBQUosRUFBZ0Q7QUFDOUMsZUFBTyxJQUFQLENBRDhDLENBQ2pDO0FBQ2Q7QUFDRjs7QUFFRCxXQUFPLEtBQVAsQ0FmZ0QsQ0FlbEM7QUFDZjs7QUFFRCxTQUFPLElBQVAsQ0FuQm1ELENBbUJ0QztBQUNkO0FBRUQ7Ozs7Ozs7OztBQU9BLFNBQVNaLFdBQVQsQ0FBcUJWLGNBQXJCLEVBQXFDYSxDQUFyQyxFQUF3Q1csT0FBeEMsRUFBaUQ7QUFDL0MsTUFBSXhCLGNBQWMsQ0FBQ3lCLFdBQWYsRUFBSixFQUFrQztBQUNoQyxXQUFPLEtBQVAsQ0FEZ0MsQ0FDbEI7QUFDZjs7QUFFRCxTQUFPLElBQVAsQ0FMK0MsQ0FLbEM7QUFDZDtBQUVEOzs7Ozs7Ozs7O0FBUUEsU0FBU2IsaUJBQVQsQ0FDRVosY0FERixFQUVFMEIsYUFGRixFQUdFQyxjQUhGLEVBSUVDLGdCQUpGLEVBS0U7QUFDQSxNQUFJNUIsY0FBYyxDQUFDNkIsaUJBQWYsRUFBSixFQUF3QztBQUN0QyxRQUFJLENBQ0Esa0RBQTRCSCxhQUE1QixLQUNBLGtEQUE0QkMsY0FBNUIsQ0FGQSxLQUlGM0IsY0FBYyxDQUFDZ0IsMEJBQWYsRUFKRixFQUtFO0FBQ0EsYUFBTyxJQUFQO0FBQ0Q7O0FBQ0QsUUFBTUksbUJBQW1CLEdBQUdwQixjQUFjLENBQUM4QiwrQkFBZixFQUE1Qjs7QUFFQSxTQUFLLElBQUlSLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdGLG1CQUFtQixDQUFDRCxNQUF4QyxFQUFnREcsQ0FBQyxFQUFqRCxFQUFxRDtBQUNuRCxVQUFJSSxhQUFhLENBQUNILFFBQWQsQ0FBdUJILG1CQUFtQixDQUFDRSxDQUFELENBQTFDLENBQUosRUFBb0Q7QUFDbEQsZUFBTyxJQUFQO0FBQ0Q7QUFDRixLQWZxQyxDQWlCdEM7OztBQUNBLFdBQU9NLGdCQUFnQixDQUFDRixhQUFELEVBQWdCQyxjQUFoQixDQUF2QjtBQUNEOztBQUVELFNBQU8sSUFBUCxDQXRCQSxDQXNCYTtBQUNkOztlQUVjO0FBQ2I1QixFQUFBQSxlQUFlLEVBQWZBO0FBRGEsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGlzU2VsZWN0b3JSYW5kb21seUdlbmVyYXRlZCB9IGZyb20gJy4vcmVsZXZhbmNlLWhlbHBlcic7XG5cbi8qKlxuICogVHJhbnNmb3JtcyBhU2VsZWN0b3JDb25maWcgaW50byBvcHRpbWFsLXNlbGVjdCBvcHRpb25zXG4gKiBAcGFyYW0ge1NlbGVjdG9yQ29uZmlnfSBzZWxlY3RvckNvbmZpZ1xuICogQHJldHVybiB7T2JqZWN0fVxuICovXG5leHBvcnQgY29uc3QgY29uZmlnVG9PcHRpb25zID0gc2VsZWN0b3JDb25maWcgPT4gKHtcbiAgcm9vdDogZG9jdW1lbnQsXG4gIC8vIGRlZmluZSBvcmRlciBvZiBhdHRyaWJ1dGUgcHJvY2Vzc2luZ1xuICBwcmlvcml0eTogWydpZCcsICdjbGFzcyddLFxuICAvLyBzcGVjaWZ5IHdoaWNoIGF0dHJpYnV0ZXMgdG8gaWdub3JlXG4gIGlnbm9yZToge1xuICAgIGlkOiBpZ25vcmVJZEZuLmJpbmQodGhpcywgc2VsZWN0b3JDb25maWcpLFxuICAgIGNsYXNzOiBpZ25vcmVDbGFzc0ZuLmJpbmQodGhpcywgc2VsZWN0b3JDb25maWcpLFxuICAgIHRhZzogaWdub3JlVGFnRm4uYmluZCh0aGlzLCBzZWxlY3RvckNvbmZpZyksXG4gICAgYXR0cmlidXRlOiBpZ25vcmVBdHRyaWJ1dGVGbi5iaW5kKHRoaXMsIHNlbGVjdG9yQ29uZmlnKSxcbiAgfVxufSk7XG5cbi8qKlxuICogRGVjaWRlcyBpZiBpZHMgc2hvdWxkIGJlIHVzZWQgaW4gc2VsZWN0b3IgZ2VuZXJhdGlvblxuICogQHBhcmFtIHtTZWxlY3RvckNvbmZpZ30gc2VsZWN0b3JDb25maWdcbiAqIEBwYXJhbSB7c3RyaW5nfSBhXG4gKiBAcGFyYW0ge3N0cmluZ30gaWROYW1lXG4gKiBAcmV0dXJuIHtib29sZWFufVxuICovXG5mdW5jdGlvbiBpZ25vcmVJZEZuKHNlbGVjdG9yQ29uZmlnLCBhLCBpZE5hbWUpIHtcbiAgaWYgKHNlbGVjdG9yQ29uZmlnLmlzQWxsb3dJZHMoKSkge1xuICAgIGlmIChpc1NlbGVjdG9yUmFuZG9tbHlHZW5lcmF0ZWQoaWROYW1lKSAmJiBzZWxlY3RvckNvbmZpZy5pc0V4Y2x1ZGluZ1JhbmRvbVNlbGVjdG9ycygpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7IC8vIGFsbG93IGFsbCBpZHMgdGhhdCByZWFjaGVkIHRoaXMgcG9pbnRcbiAgfVxuXG4gIHJldHVybiB0cnVlOyAvLyBpZ25vcmUgYWxsIGlkc1xufVxuXG4vKipcbiAqIERlY2lkZXMgaWYgY2xhc3NlcyBzaG91bGQgYmUgdXNlZCBpbiBzZWxlY3RvciBnZW5lcmF0aW9uXG4gKiBAcGFyYW0ge1NlbGVjdG9yQ29uZmlnfSBzZWxlY3RvckNvbmZpZ1xuICogQHBhcmFtIHtzdHJpbmd9IGFcbiAqIEBwYXJhbSB7c3RyaW5nfSBjbGFzc05hbWVcbiAqIEByZXR1cm4ge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIGlnbm9yZUNsYXNzRm4oc2VsZWN0b3JDb25maWcsIGEsIGNsYXNzTmFtZSkge1xuICBpZiAoY2xhc3NOYW1lICYmIHNlbGVjdG9yQ29uZmlnLmlzQWxsb3dDbGFzc2VzKCkpIHtcbiAgICBpZiAoY2xhc3NOYW1lLmxlbmd0aCA+IDMwKSB7XG4gICAgICByZXR1cm4gdHJ1ZTsgLy8gaWdub3JlIGxvbmcgY2xhc3Nlc1xuICAgIH1cbiAgICBpZiAoaXNTZWxlY3RvclJhbmRvbWx5R2VuZXJhdGVkKGNsYXNzTmFtZSkgJiYgc2VsZWN0b3JDb25maWcuaXNFeGNsdWRpbmdSYW5kb21TZWxlY3RvcnMoKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IGZvcmJpZGRlblN1YnN0cmluZ3MgPSBzZWxlY3RvckNvbmZpZy5nZXRGb3JiaWRkZW5DbGFzc1N1YnN0cmluZ3MoKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9yYmlkZGVuU3Vic3RyaW5ncy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGNsYXNzTmFtZS5pbmNsdWRlcyhmb3JiaWRkZW5TdWJzdHJpbmdzW2ldKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gaWdub3JlIGNsYXNzIG5hbWUgd2l0aCBmb3JiaWRkZW4gc3Vic3RyaW5nXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlOyAvLyBkb24ndCBpZ25vcmUgY2xhc3NlcyB3aG8gcmVhY2hlZCB1bnRpbCBoZXJlXG4gIH1cblxuICByZXR1cm4gdHJ1ZTsgLy8gaWdub3JlIGFsbCBjbGFzc2VzXG59XG5cbi8qKlxuICogRGVjaWRlcyBpZiB0YWdzIHNob3VsZCBiZSB1c2VkIGluIHNlbGVjdG9yIGdlbmVyYXRpb25cbiAqIEBwYXJhbSB7U2VsZWN0b3JDb25maWd9IHNlbGVjdG9yQ29uZmlnXG4gKiBAcGFyYW0ge3N0cmluZ30gYVxuICogQHBhcmFtIHtzdHJpbmd9IHRhZ05hbWVcbiAqIEByZXR1cm4ge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIGlnbm9yZVRhZ0ZuKHNlbGVjdG9yQ29uZmlnLCBhLCB0YWdOYW1lKSB7XG4gIGlmIChzZWxlY3RvckNvbmZpZy5pc0FsbG93VGFncygpKSB7XG4gICAgcmV0dXJuIGZhbHNlOyAvLyBhbGxvdyBhbGwgdGFnc1xuICB9XG5cbiAgcmV0dXJuIHRydWU7IC8vIGlnbm9yZSBhbGwgdGFnc1xufVxuXG4vKipcbiAqIERlY2lkZXMgaWYgYXR0cmlidXRlcyBzaG91bGQgYmUgdXNlZCBpbiBzZWxlY3RvciBnZW5lcmF0aW9uXG4gKiBAcGFyYW0ge1NlbGVjdG9yQ29uZmlnfSBzZWxlY3RvckNvbmZpZ1xuICogQHBhcmFtIHtzdHJpbmd9IGF0dHJpYnV0ZU5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBhdHRyaWJ1dGVWYWx1ZVxuICogQHBhcmFtIHtGdW5jdGlvbn0gZGVmYXVsdFByZWRpY2F0ZVxuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gaWdub3JlQXR0cmlidXRlRm4oXG4gIHNlbGVjdG9yQ29uZmlnLFxuICBhdHRyaWJ1dGVOYW1lLFxuICBhdHRyaWJ1dGVWYWx1ZSxcbiAgZGVmYXVsdFByZWRpY2F0ZVxuKSB7XG4gIGlmIChzZWxlY3RvckNvbmZpZy5pc0FsbG93QXR0cmlidXRlcygpKSB7XG4gICAgaWYgKChcbiAgICAgICAgaXNTZWxlY3RvclJhbmRvbWx5R2VuZXJhdGVkKGF0dHJpYnV0ZU5hbWUpIHx8XG4gICAgICAgIGlzU2VsZWN0b3JSYW5kb21seUdlbmVyYXRlZChhdHRyaWJ1dGVWYWx1ZSlcbiAgICAgICkgJiZcbiAgICAgIHNlbGVjdG9yQ29uZmlnLmlzRXhjbHVkaW5nUmFuZG9tU2VsZWN0b3JzKClcbiAgICApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjb25zdCBmb3JiaWRkZW5TdWJzdHJpbmdzID0gc2VsZWN0b3JDb25maWcuZ2V0Rm9yYmlkZGVuQXR0cmlidXRlU3Vic3RyaW5ncygpO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmb3JiaWRkZW5TdWJzdHJpbmdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoYXR0cmlidXRlTmFtZS5pbmNsdWRlcyhmb3JiaWRkZW5TdWJzdHJpbmdzW2ldKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBhbGxvdyBkZWZhdWx0IGF0dHJpYnV0ZXNcbiAgICByZXR1cm4gZGVmYXVsdFByZWRpY2F0ZShhdHRyaWJ1dGVOYW1lLCBhdHRyaWJ1dGVWYWx1ZSk7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTsgLy8gaWdub3JlIGFsbCBhdHRyaWJ1dGVzXG59XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgY29uZmlnVG9PcHRpb25zXG59O1xuIl0sImZpbGUiOiJzZWxlY3Rvci1nZW5lcmF0aW9uL3Byb2R1Y2Utc2VsZWN0b3Ivb3B0aW9ucy1jb252ZXJ0ZXIuanMifQ==
