"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.configToOptions = void 0;

var _relevanceHelper = require("./relevance-helper");

var _this = void 0;

/**
 * Transforms aSelectorConfig into optimal-select options
 * @param {SelectorConfig} selectorConfig
 * @return {Object}
 */
var configToOptions = function configToOptions(selectorConfig) {
  return {
    root: document,
    // define order of attribute processing
    priority: ['id', 'class'],
    // specify which attributes to ignore
    ignore: {
      id: ignoreIdFn.bind(_this, selectorConfig),
      "class": ignoreClassFn.bind(_this, selectorConfig),
      tag: ignoreTagFn.bind(_this, selectorConfig),
      attribute: ignoreAttributeFn.bind(_this, selectorConfig)
    },
    exclude: {
      "class": excludeClassFn.bind(_this, selectorConfig)
    }
  };
};
/**
 * Decides if ids should be used in selector generation
 * @param {SelectorConfig} selectorConfig
 * @param {string} a
 * @param {string} idName
 * @return {boolean}
 */


exports.configToOptions = configToOptions;

function ignoreIdFn(selectorConfig, a, idName) {
  if (selectorConfig.isAllowIds()) {
    if ((0, _relevanceHelper.isSelectorRandomlyGenerated)(idName) && selectorConfig.isExcludingRandomSelectors()) {
      return true;
    }

    var forbiddenSubstrings = selectorConfig.getForbiddenIdSubstrings();

    for (var i = 0; i < forbiddenSubstrings.length; i++) {
      if (idName.includes(forbiddenSubstrings[i])) {
        return true; // ignore id name with forbidden substring
      }
    }

    return false; // allow all ids that reached this point
  }

  return true; // ignore all ids
}
/**
 * Decides if classes should be used in selector generation
 * @param {SelectorConfig} selectorConfig
 * @param {string} a
 * @param {string} className
 * @return {boolean}
 */


function ignoreClassFn(selectorConfig, a, className) {
  if (className && selectorConfig.isAllowClasses()) {
    if (className.length > 30) {
      return true; // ignore long classes
    } // if (isSelectorRandomlyGenerated(className) && selectorConfig.isExcludingRandomSelectors()) {
    //   return true;
    // }
    // const forbiddenSubstrings = selectorConfig.getForbiddenClassSubstrings();
    //
    // for (let i = 0; i < forbiddenSubstrings.length; i++) {
    //   if (className.includes(forbiddenSubstrings[i])) {
    //     return true; // ignore class name with forbidden substring
    //   }
    // }


    return false; // don't ignore classes who reached until here
  }

  return true; // ignore all classes
}
/**
 * Decides if tags should be used in selector generation
 * @param {SelectorConfig} selectorConfig
 * @param {string} a
 * @param {string} tagName
 * @return {boolean}
 */


function ignoreTagFn(selectorConfig, a, tagName) {
  if (selectorConfig.isAllowTags()) {
    return false; // allow all tags
  }

  return true; // ignore all tags
}
/**
 * Decides if attributes should be used in selector generation
 * @param {SelectorConfig} selectorConfig
 * @param {string} attributeName
 * @param {string} attributeValue
 * @param {Function} defaultPredicate
 * @return {boolean}
 */


function ignoreAttributeFn(selectorConfig, attributeName, attributeValue, defaultPredicate) {
  if (selectorConfig.isAllowAttributes()) {
    if (((0, _relevanceHelper.isSelectorRandomlyGenerated)(attributeName) || (0, _relevanceHelper.isSelectorRandomlyGenerated)(attributeValue)) && selectorConfig.isExcludingRandomSelectors()) {
      return true;
    }

    var forbiddenSubstrings = selectorConfig.getForbiddenAttributeSubstrings();

    for (var i = 0; i < forbiddenSubstrings.length; i++) {
      if (attributeName.includes(forbiddenSubstrings[i])) {
        return true;
      }
    } // allow default attributes


    return defaultPredicate(attributeName, attributeValue);
  }

  return true; // ignore all attributes
}

function excludeClassFn(selectorConfig, classsName) {
  if (className && selectorConfig.isAllowClasses()) {
    // if (className.length > 30) {
    //   return true; // ignore long classes
    // }
    if ((0, _relevanceHelper.isSelectorRandomlyGenerated)(className) && selectorConfig.isExcludingRandomSelectors()) {
      return true;
    }

    var forbiddenSubstrings = selectorConfig.getForbiddenClassSubstrings();

    for (var i = 0; i < forbiddenSubstrings.length; i++) {
      if (className.includes(forbiddenSubstrings[i])) {
        return true; // ignore class name with forbidden substring
      }
    }

    return false; // don't ignore classes who reached until here
  } // ever here?


  return true;
}

var _default = {
  configToOptions: configToOptions
};
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlbGVjdG9yLWdlbmVyYXRpb24vcHJvZHVjZS1zZWxlY3Rvci9vcHRpb25zLWNvbnZlcnRlci5qcyJdLCJuYW1lcyI6WyJjb25maWdUb09wdGlvbnMiLCJzZWxlY3RvckNvbmZpZyIsInJvb3QiLCJkb2N1bWVudCIsInByaW9yaXR5IiwiaWdub3JlIiwiaWQiLCJpZ25vcmVJZEZuIiwiYmluZCIsImlnbm9yZUNsYXNzRm4iLCJ0YWciLCJpZ25vcmVUYWdGbiIsImF0dHJpYnV0ZSIsImlnbm9yZUF0dHJpYnV0ZUZuIiwiZXhjbHVkZSIsImV4Y2x1ZGVDbGFzc0ZuIiwiYSIsImlkTmFtZSIsImlzQWxsb3dJZHMiLCJpc0V4Y2x1ZGluZ1JhbmRvbVNlbGVjdG9ycyIsImZvcmJpZGRlblN1YnN0cmluZ3MiLCJnZXRGb3JiaWRkZW5JZFN1YnN0cmluZ3MiLCJpIiwibGVuZ3RoIiwiaW5jbHVkZXMiLCJjbGFzc05hbWUiLCJpc0FsbG93Q2xhc3NlcyIsInRhZ05hbWUiLCJpc0FsbG93VGFncyIsImF0dHJpYnV0ZU5hbWUiLCJhdHRyaWJ1dGVWYWx1ZSIsImRlZmF1bHRQcmVkaWNhdGUiLCJpc0FsbG93QXR0cmlidXRlcyIsImdldEZvcmJpZGRlbkF0dHJpYnV0ZVN1YnN0cmluZ3MiLCJjbGFzc3NOYW1lIiwiZ2V0Rm9yYmlkZGVuQ2xhc3NTdWJzdHJpbmdzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7QUFFQTs7Ozs7QUFLTyxJQUFNQSxlQUFlLEdBQUcsU0FBbEJBLGVBQWtCLENBQUFDLGNBQWM7QUFBQSxTQUFLO0FBQ2hEQyxJQUFBQSxJQUFJLEVBQUVDLFFBRDBDO0FBRWhEO0FBQ0FDLElBQUFBLFFBQVEsRUFBRSxDQUFDLElBQUQsRUFBTyxPQUFQLENBSHNDO0FBSWhEO0FBQ0FDLElBQUFBLE1BQU0sRUFBRTtBQUNOQyxNQUFBQSxFQUFFLEVBQUVDLFVBQVUsQ0FBQ0MsSUFBWCxDQUFnQixLQUFoQixFQUFzQlAsY0FBdEIsQ0FERTtBQUVOLGVBQU9R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S0FmcUMsQ0FpQnRDOzs7QUFDQSxXQUFPUyxnQkFBZ0IsQ0FBQ0YsYUFBRCxFQUFnQkMsY0FBaEIsQ0FBdkI7QUFDRDs7QUFFRCxTQUFPLElBQVAsQ0F0QkEsQ0FzQmE7QUFDZDs7QUFFRCxTQUFTZixjQUFULENBQXdCZCxjQUF4QixFQUF3Q2lDLFVBQXhDLEVBQW9EO0FBQ2xELE1BQUlULFNBQVMsSUFBSXhCLGNBQWMsQ0FBQ3lCLGNBQWYsRUFBakIsRUFBa0Q7QUFDaEQ7QUFDQTtBQUNBO0FBQ0EsUUFBSSxrREFBNEJELFNBQTVCLEtBQTBDeEIsY0FBYyxDQUFDa0IsMEJBQWYsRUFBOUMsRUFBMkY7QUFDekYsYUFBTyxJQUFQO0FBQ0Q7O0FBQ0QsUUFBTUMsbUJBQW1CLEdBQUduQixjQUFjLENBQUNrQywyQkFBZixFQUE1Qjs7QUFFQSxTQUFLLElBQUliLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdGLG1CQUFtQixDQUFDRyxNQUF4QyxFQUFnREQsQ0FBQyxFQUFqRCxFQUFxRDtBQUNuRCxVQUFJRyxTQUFTLENBQUNELFFBQVYsQ0FBbUJKLG1CQUFtQixDQUFDRSxDQUFELENBQXRDLENBQUosRUFBZ0Q7QUFDOUMsZUFBTyxJQUFQLENBRDhDLENBQ2pDO0FBQ2Q7QUFDRjs7QUFFRCxXQUFPLEtBQVAsQ0FmZ0QsQ0FlbEM7QUFDZixHQWpCaUQsQ0FrQmxEOzs7QUFDQSxTQUFPLElBQVA7QUFDRDs7ZUFFYztBQUNidEIsRUFBQUEsZUFBZSxFQUFmQTtBQURhLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc1NlbGVjdG9yUmFuZG9tbHlHZW5lcmF0ZWQgfSBmcm9tICcuL3JlbGV2YW5jZS1oZWxwZXInO1xuXG4vKipcbiAqIFRyYW5zZm9ybXMgYVNlbGVjdG9yQ29uZmlnIGludG8gb3B0aW1hbC1zZWxlY3Qgb3B0aW9uc1xuICogQHBhcmFtIHtTZWxlY3RvckNvbmZpZ30gc2VsZWN0b3JDb25maWdcbiAqIEByZXR1cm4ge09iamVjdH1cbiAqL1xuZXhwb3J0IGNvbnN0IGNvbmZpZ1RvT3B0aW9ucyA9IHNlbGVjdG9yQ29uZmlnID0+ICh7XG4gIHJvb3Q6IGRvY3VtZW50LFxuICAvLyBkZWZpbmUgb3JkZXIgb2YgYXR0cmlidXRlIHByb2Nlc3NpbmdcbiAgcHJpb3JpdHk6IFsnaWQnLCAnY2xhc3MnXSxcbiAgLy8gc3BlY2lmeSB3aGljaCBhdHRyaWJ1dGVzIHRvIGlnbm9yZVxuICBpZ25vcmU6IHtcbiAgICBpZDogaWdub3JlSWRGbi5iaW5kKHRoaXMsIHNlbGVjdG9yQ29uZmlnKSxcbiAgICBjbGFzczogaWdub3JlQ2xhc3NGbi5iaW5kKHRoaXMsIHNlbGVjdG9yQ29uZmlnKSxcbiAgICB0YWc6IGlnbm9yZVRhZ0ZuLmJpbmQodGhpcywgc2VsZWN0b3JDb25maWcpLFxuICAgIGF0dHJpYnV0ZTogaWdub3JlQXR0cmlidXRlRm4uYmluZCh0aGlzLCBzZWxlY3RvckNvbmZpZyksXG4gIH0sXG4gIGV4Y2x1ZGU6IHtcbiAgICBjbGFzczogZXhjbHVkZUNsYXNzRm4uYmluZCh0aGlzLCBzZWxlY3RvckNvbmZpZyksXG4gIH1cbn0pO1xuXG4vKipcbiAqIERlY2lkZXMgaWYgaWRzIHNob3VsZCBiZSB1c2VkIGluIHNlbGVjdG9yIGdlbmVyYXRpb25cbiAqIEBwYXJhbSB7U2VsZWN0b3JDb25maWd9IHNlbGVjdG9yQ29uZmlnXG4gKiBAcGFyYW0ge3N0cmluZ30gYVxuICogQHBhcmFtIHtzdHJpbmd9IGlkTmFtZVxuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gaWdub3JlSWRGbihzZWxlY3RvckNvbmZpZywgYSwgaWROYW1lKSB7XG4gIGlmIChzZWxlY3RvckNvbmZpZy5pc0FsbG93SWRzKCkpIHtcbiAgICBpZiAoaXNTZWxlY3RvclJhbmRvbWx5R2VuZXJhdGVkKGlkTmFtZSkgJiYgc2VsZWN0b3JDb25maWcuaXNFeGNsdWRpbmdSYW5kb21TZWxlY3RvcnMoKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IGZvcmJpZGRlblN1YnN0cmluZ3MgPSBzZWxlY3RvckNvbmZpZy5nZXRGb3JiaWRkZW5JZFN1YnN0cmluZ3MoKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9yYmlkZGVuU3Vic3RyaW5ncy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGlkTmFtZS5pbmNsdWRlcyhmb3JiaWRkZW5TdWJzdHJpbmdzW2ldKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gaWdub3JlIGlkIG5hbWUgd2l0aCBmb3JiaWRkZW4gc3Vic3RyaW5nXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlOyAvLyBhbGxvdyBhbGwgaWRzIHRoYXQgcmVhY2hlZCB0aGlzIHBvaW50XG4gIH1cblxuICByZXR1cm4gdHJ1ZTsgLy8gaWdub3JlIGFsbCBpZHNcbn1cblxuLyoqXG4gKiBEZWNpZGVzIGlmIGNsYXNzZXMgc2hvdWxkIGJlIHVzZWQgaW4gc2VsZWN0b3IgZ2VuZXJhdGlvblxuICogQHBhcmFtIHtTZWxlY3RvckNvbmZpZ30gc2VsZWN0b3JDb25maWdcbiAqIEBwYXJhbSB7c3RyaW5nfSBhXG4gKiBAcGFyYW0ge3N0cmluZ30gY2xhc3NOYW1lXG4gKiBAcmV0dXJuIHtib29sZWFufVxuICovXG5mdW5jdGlvbiBpZ25vcmVDbGFzc0ZuKHNlbGVjdG9yQ29uZmlnLCBhLCBjbGFzc05hbWUpIHtcbiAgaWYgKGNsYXNzTmFtZSAmJiBzZWxlY3RvckNvbmZpZy5pc0FsbG93Q2xhc3NlcygpKSB7XG4gICAgaWYgKGNsYXNzTmFtZS5sZW5ndGggPiAzMCkge1xuICAgICAgcmV0dXJuIHRydWU7IC8vIGlnbm9yZSBsb25nIGNsYXNzZXNcbiAgICB9XG4gICAgLy8gaWYgKGlzU2VsZWN0b3JSYW5kb21seUdlbmVyYXRlZChjbGFzc05hbWUpICYmIHNlbGVjdG9yQ29uZmlnLmlzRXhjbHVkaW5nUmFuZG9tU2VsZWN0b3JzKCkpIHtcbiAgICAvLyAgIHJldHVybiB0cnVlO1xuICAgIC8vIH1cbiAgICAvLyBjb25zdCBmb3JiaWRkZW5TdWJzdHJpbmdzID0gc2VsZWN0b3JDb25maWcuZ2V0Rm9yYmlkZGVuQ2xhc3NTdWJzdHJpbmdzKCk7XG4gICAgLy9cbiAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IGZvcmJpZGRlblN1YnN0cmluZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAvLyAgIGlmIChjbGFzc05hbWUuaW5jbHVkZXMoZm9yYmlkZGVuU3Vic3RyaW5nc1tpXSkpIHtcbiAgICAvLyAgICAgcmV0dXJuIHRydWU7IC8vIGlnbm9yZSBjbGFzcyBuYW1lIHdpdGggZm9yYmlkZGVuIHN1YnN0cmluZ1xuICAgIC8vICAgfVxuICAgIC8vIH1cblxuICAgIHJldHVybiBmYWxzZTsgLy8gZG9uJ3QgaWdub3JlIGNsYXNzZXMgd2hvIHJlYWNoZWQgdW50aWwgaGVyZVxuICB9XG5cbiAgcmV0dXJuIHRydWU7IC8vIGlnbm9yZSBhbGwgY2xhc3Nlc1xufVxuXG4vKipcbiAqIERlY2lkZXMgaWYgdGFncyBzaG91bGQgYmUgdXNlZCBpbiBzZWxlY3RvciBnZW5lcmF0aW9uXG4gKiBAcGFyYW0ge1NlbGVjdG9yQ29uZmlnfSBzZWxlY3RvckNvbmZpZ1xuICogQHBhcmFtIHtzdHJpbmd9IGFcbiAqIEBwYXJhbSB7c3RyaW5nfSB0YWdOYW1lXG4gKiBAcmV0dXJuIHtib29sZWFufVxuICovXG5mdW5jdGlvbiBpZ25vcmVUYWdGbihzZWxlY3RvckNvbmZpZywgYSwgdGFnTmFtZSkge1xuICBpZiAoc2VsZWN0b3JDb25maWcuaXNBbGxvd1RhZ3MoKSkge1xuICAgIHJldHVybiBmYWxzZTsgLy8gYWxsb3cgYWxsIHRhZ3NcbiAgfVxuXG4gIHJldHVybiB0cnVlOyAvLyBpZ25vcmUgYWxsIHRhZ3Ncbn1cblxuLyoqXG4gKiBEZWNpZGVzIGlmIGF0dHJpYnV0ZXMgc2hvdWxkIGJlIHVzZWQgaW4gc2VsZWN0b3IgZ2VuZXJhdGlvblxuICogQHBhcmFtIHtTZWxlY3RvckNvbmZpZ30gc2VsZWN0b3JDb25maWdcbiAqIEBwYXJhbSB7c3RyaW5nfSBhdHRyaWJ1dGVOYW1lXG4gKiBAcGFyYW0ge3N0cmluZ30gYXR0cmlidXRlVmFsdWVcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGRlZmF1bHRQcmVkaWNhdGVcbiAqIEByZXR1cm4ge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIGlnbm9yZUF0dHJpYnV0ZUZuKFxuICBzZWxlY3RvckNvbmZpZyxcbiAgYXR0cmlidXRlTmFtZSxcbiAgYXR0cmlidXRlVmFsdWUsXG4gIGRlZmF1bHRQcmVkaWNhdGVcbikge1xuICBpZiAoc2VsZWN0b3JDb25maWcuaXNBbGxvd0F0dHJpYnV0ZXMoKSkge1xuICAgIGlmICgoXG4gICAgICAgIGlzU2VsZWN0b3JSYW5kb21seUdlbmVyYXRlZChhdHRyaWJ1dGVOYW1lKSB8fFxuICAgICAgICBpc1NlbGVjdG9yUmFuZG9tbHlHZW5lcmF0ZWQoYXR0cmlidXRlVmFsdWUpXG4gICAgICApICYmXG4gICAgICBzZWxlY3RvckNvbmZpZy5pc0V4Y2x1ZGluZ1JhbmRvbVNlbGVjdG9ycygpXG4gICAgKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgZm9yYmlkZGVuU3Vic3RyaW5ncyA9IHNlbGVjdG9yQ29uZmlnLmdldEZvcmJpZGRlbkF0dHJpYnV0ZVN1YnN0cmluZ3MoKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9yYmlkZGVuU3Vic3RyaW5ncy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGF0dHJpYnV0ZU5hbWUuaW5jbHVkZXMoZm9yYmlkZGVuU3Vic3RyaW5nc1tpXSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gYWxsb3cgZGVmYXVsdCBhdHRyaWJ1dGVzXG4gICAgcmV0dXJuIGRlZmF1bHRQcmVkaWNhdGUoYXR0cmlidXRlTmFtZSwgYXR0cmlidXRlVmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7IC8vIGlnbm9yZSBhbGwgYXR0cmlidXRlc1xufVxuXG5mdW5jdGlvbiBleGNsdWRlQ2xhc3NGbihzZWxlY3RvckNvbmZpZywgY2xhc3NzTmFtZSkge1xuICBpZiAoY2xhc3NOYW1lICYmIHNlbGVjdG9yQ29uZmlnLmlzQWxsb3dDbGFzc2VzKCkpIHtcbiAgICAvLyBpZiAoY2xhc3NOYW1lLmxlbmd0aCA+IDMwKSB7XG4gICAgLy8gICByZXR1cm4gdHJ1ZTsgLy8gaWdub3JlIGxvbmcgY2xhc3Nlc1xuICAgIC8vIH1cbiAgICBpZiAoaXNTZWxlY3RvclJhbmRvbWx5R2VuZXJhdGVkKGNsYXNzTmFtZSkgJiYgc2VsZWN0b3JDb25maWcuaXNFeGNsdWRpbmdSYW5kb21TZWxlY3RvcnMoKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IGZvcmJpZGRlblN1YnN0cmluZ3MgPSBzZWxlY3RvckNvbmZpZy5nZXRGb3JiaWRkZW5DbGFzc1N1YnN0cmluZ3MoKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9yYmlkZGVuU3Vic3RyaW5ncy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGNsYXNzTmFtZS5pbmNsdWRlcyhmb3JiaWRkZW5TdWJzdHJpbmdzW2ldKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gaWdub3JlIGNsYXNzIG5hbWUgd2l0aCBmb3JiaWRkZW4gc3Vic3RyaW5nXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlOyAvLyBkb24ndCBpZ25vcmUgY2xhc3NlcyB3aG8gcmVhY2hlZCB1bnRpbCBoZXJlXG4gIH1cbiAgLy8gZXZlciBoZXJlP1xuICByZXR1cm4gdHJ1ZTtcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBjb25maWdUb09wdGlvbnNcbn07XG4iXSwiZmlsZSI6InNlbGVjdG9yLWdlbmVyYXRpb24vcHJvZHVjZS1zZWxlY3Rvci9vcHRpb25zLWNvbnZlcnRlci5qcyJ9
