"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.configToOptions = void 0;

var _relevanceHelper = require("./relevance-helper");

var _this = void 0;

/**
 * Transforms aSelectorConfig into optimal-select options
 * @param {SelectorConfig} selectorConfig
 * @return {Object}
 */
var configToOptions = function configToOptions(selectorConfig) {
  return {
    root: document,
    // define order of attribute processing
    priority: ['id', 'class'],
    // specify which attributes to ignore
    ignore: {
      id: ignoreIdFn.bind(_this, selectorConfig),
      "class": ignoreClassFn.bind(_this, selectorConfig),
      tag: ignoreTagFn.bind(_this, selectorConfig),
      attribute: ignoreAttributeFn.bind(_this, selectorConfig)
    },
    exclude: {
      className: excludeClassFn.bind(_this, selectorConfig)
    }
  };
};
/**
 * Decides if ids should be used in selector generation
 * @param {SelectorConfig} selectorConfig
 * @param {string} attributeName this is not used by us in this case is always equal with 'id' string from "[id='idName']"
 * @param {string} attributeValue this is the idName
 * @return {boolean}
 */


exports.configToOptions = configToOptions;

function ignoreIdFn(selectorConfig, attributeName, attributeValue) {
  if (selectorConfig.isAllowIds()) {
    if ((0, _relevanceHelper.isSelectorRandomlyGenerated)(attributeValue) && selectorConfig.isExcludingRandomSelectors()) {
      return true;
    }

    var forbiddenSubstrings = selectorConfig.getForbiddenIdSubstrings();

    for (var i = 0; i < forbiddenSubstrings.length; i++) {
      if (attributeValue.includes(forbiddenSubstrings[i])) {
        return true; // ignore id name with forbidden substring
      }
    }

    return false; // allow all ids that reached this point
  }

  return true; // ignore all ids
}
/**
 * Decides if classes should be used in selector generation
 * @param {SelectorConfig} selectorConfig
 * @param {string} attributeName this is not used by us in this case is always equal with 'class' string from "[class='className']"
 * @param {string} attributeValue this is the className
 * @return {boolean}
 */


function ignoreClassFn(selectorConfig, attributeName, attributeValue) {
  if (attributeValue && selectorConfig.isAllowClasses()) {
    return false; // allow all classes
  }

  return true; // ignore all classes
}
/**
 * Decides if tags should be used in selector generation
 * @param {SelectorConfig} selectorConfig
 * @param {string} nullParameter this is not used by us and it's null all the time here
 * @param {string} tagName
 * @return {boolean}
 */


function ignoreTagFn(selectorConfig, nullParameter, tagName) {
  if (selectorConfig.isAllowTags()) {
    return false; // allow all tags
  }

  return true; // ignore all tags
}
/**
 * Decides if attributes should be used in selector generation
 * @param {SelectorConfig} selectorConfig
 * @param {string} attributeName
 * @param {string} attributeValue
 * @param {Function} defaultPredicate
 * @return {boolean}
 */


function ignoreAttributeFn(selectorConfig, attributeName, attributeValue, defaultPredicate) {
  if (selectorConfig.isAllowAttributes()) {
    if (((0, _relevanceHelper.isSelectorRandomlyGenerated)(attributeName) || (0, _relevanceHelper.isSelectorRandomlyGenerated)(attributeValue)) && selectorConfig.isExcludingRandomSelectors()) {
      return true;
    }

    var forbiddenSubstrings = selectorConfig.getForbiddenAttributeSubstrings();

    for (var i = 0; i < forbiddenSubstrings.length; i++) {
      if (attributeName.includes(forbiddenSubstrings[i])) {
        return true;
      }
    } // allow default attributes


    return defaultPredicate(attributeName, attributeValue);
  }

  return true; // ignore all attributes
}
/**
 * Decides if a className should be excluded
 * @param {SelectorConfig} selectorConfig
 * @param {string} className
 *
 * @return {boolean}
 */


function excludeClassFn(selectorConfig, className) {
  if (className && className.length > 30) {
    return true; // ignore long classes
  }

  if ((0, _relevanceHelper.isSelectorRandomlyGenerated)(className) && selectorConfig.isExcludingRandomSelectors()) {
    return true;
  }

  var forbiddenSubstrings = selectorConfig.getForbiddenClassSubstrings();

  for (var i = 0; i < forbiddenSubstrings.length; i++) {
    if (className.includes(forbiddenSubstrings[i])) {
      return true; // ignore class name with forbidden substring
    }
  }

  return false; // don't exclude classes who reached until here
}

var _default = {
  configToOptions: configToOptions
};
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlbGVjdG9yLWdlbmVyYXRpb24vcHJvZHVjZS1zZWxlY3Rvci9vcHRpb25zLWNvbnZlcnRlci5qcyJdLCJuYW1lcyI6WyJjb25maWdUb09wdGlvbnMiLCJzZWxlY3RvckNvbmZpZyIsInJvb3QiLCJkb2N1bWVudCIsInByaW9yaXR5IiwiaWdub3JlIiwiaWQiLCJpZ25vcmVJZEZuIiwiYmluZCIsImlnbm9yZUNsYXNzRm4iLCJ0YWciLCJpZ25vcmVUYWdGbiIsImF0dHJpYnV0ZSIsImlnbm9yZUF0dHJpYnV0ZUZuIiwiZXhjbHVkZSIsImNsYXNzTmFtZSIsImV4Y2x1ZGVDbGFzc0ZuIiwiYXR0cmlidXRlTmFtZSIsImF0dHJpYnV0ZVZhbHVlIiwiaXNBbGxvd0lkcyIsImlzRXhjbHVkaW5nUmFuZG9tU2VsZWN0b3JzIiwiZm9yYmlkZGVuU3Vic3RyaW5ncyIsImdldEZvcmJpZGRlbklkU3Vic3RyaW5ncyIsImkiLCJsZW5ndGgiLCJpbmNsdWRlcyIsImlzQWxsb3dDbGFzc2VzIiwibnVsbFBhcmFtZXRlciIsInRhZ05hbWUiLCJpc0FsbG93VGFncyIsImRlZmF1bHRQcmVkaWNhdGUiLCJpc0FsbG93QXR0cmlidXRlcyIsImdldEZvcmJpZGRlbkF0dHJpYnV0ZVN1YnN0cmluZ3MiLCJnZXRGb3JiaWRkZW5DbGFzc1N1YnN0cmluZ3MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTyxJQUFNQSxlQUFlLEdBQUcsU0FBbEJBLGVBQWtCLENBQUFDLGNBQWM7QUFBQSxTQUFLO0FBQ2hEQyxJQUFBQSxJQUFJLEVBQUVDLFFBRDBDO0FBRWhEO0FBQ0FDLElBQUFBLFFBQVEsRUFBRSxDQUFDLElBQUQsRUFBTyxPQUFQLENBSHNDO0FBSWhEO0FBQ0FDLElBQUFBLE1BQU0sRUFBRTtBQUNOQyxNQUFBQSxFQUFFLEVBQUVDLFVBQVUsQ0FBQ0MsSUFBWCxDQUFnQixLQUFoQixFQUFzQlAsY0FBdEIsQ0FERTtBQUVO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QUNBLFdBQU9PLGdCQUFnQixDQUFDYixhQUFELEVBQWdCQyxjQUFoQixDQUF2QjtBQUNEOztBQUVELFNBQU8sSUFBUCxDQXRCQSxDQXNCYTtBQUNkO0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBLFNBQVNGLGNBQVQsQ0FBd0JmLGNBQXhCLEVBQXdDYyxTQUF4QyxFQUFtRDtBQUNqRCxNQUFJQSxTQUFTLElBQUlBLFNBQVMsQ0FBQ1MsTUFBVixHQUFtQixFQUFwQyxFQUF3QztBQUN0QyxXQUFPLElBQVAsQ0FEc0MsQ0FDekI7QUFDZDs7QUFFRCxNQUFJLGtEQUE0QlQsU0FBNUIsS0FBMENkLGNBQWMsQ0FBQ21CLDBCQUFmLEVBQTlDLEVBQTJGO0FBQ3pGLFdBQU8sSUFBUDtBQUNEOztBQUVELE1BQU1DLG1CQUFtQixHQUFHcEIsY0FBYyxDQUFDZ0MsMkJBQWYsRUFBNUI7O0FBRUEsT0FBSyxJQUFJVixDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHRixtQkFBbUIsQ0FBQ0csTUFBeEMsRUFBZ0RELENBQUMsRUFBakQsRUFBcUQ7QUFDbkQsUUFBSVIsU0FBUyxDQUFDVSxRQUFWLENBQW1CSixtQkFBbUIsQ0FBQ0UsQ0FBRCxDQUF0QyxDQUFKLEVBQWdEO0FBQzlDLGFBQU8sSUFBUCxDQUQ4QyxDQUNqQztBQUNkO0FBQ0Y7O0FBRUQsU0FBTyxLQUFQLENBakJpRCxDQWlCbkM7QUFDZjs7ZUFFYztBQUNidkIsRUFBQUEsZUFBZSxFQUFmQTtBQURhLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc1NlbGVjdG9yUmFuZG9tbHlHZW5lcmF0ZWQgfSBmcm9tICcuL3JlbGV2YW5jZS1oZWxwZXInO1xuXG4vKipcbiAqIFRyYW5zZm9ybXMgYVNlbGVjdG9yQ29uZmlnIGludG8gb3B0aW1hbC1zZWxlY3Qgb3B0aW9uc1xuICogQHBhcmFtIHtTZWxlY3RvckNvbmZpZ30gc2VsZWN0b3JDb25maWdcbiAqIEByZXR1cm4ge09iamVjdH1cbiAqL1xuZXhwb3J0IGNvbnN0IGNvbmZpZ1RvT3B0aW9ucyA9IHNlbGVjdG9yQ29uZmlnID0+ICh7XG4gIHJvb3Q6IGRvY3VtZW50LFxuICAvLyBkZWZpbmUgb3JkZXIgb2YgYXR0cmlidXRlIHByb2Nlc3NpbmdcbiAgcHJpb3JpdHk6IFsnaWQnLCAnY2xhc3MnXSxcbiAgLy8gc3BlY2lmeSB3aGljaCBhdHRyaWJ1dGVzIHRvIGlnbm9yZVxuICBpZ25vcmU6IHtcbiAgICBpZDogaWdub3JlSWRGbi5iaW5kKHRoaXMsIHNlbGVjdG9yQ29uZmlnKSxcbiAgICBjbGFzczogaWdub3JlQ2xhc3NGbi5iaW5kKHRoaXMsIHNlbGVjdG9yQ29uZmlnKSxcbiAgICB0YWc6IGlnbm9yZVRhZ0ZuLmJpbmQodGhpcywgc2VsZWN0b3JDb25maWcpLFxuICAgIGF0dHJpYnV0ZTogaWdub3JlQXR0cmlidXRlRm4uYmluZCh0aGlzLCBzZWxlY3RvckNvbmZpZyksXG4gIH0sXG4gIGV4Y2x1ZGU6IHtcbiAgICBjbGFzc05hbWU6IGV4Y2x1ZGVDbGFzc0ZuLmJpbmQodGhpcywgc2VsZWN0b3JDb25maWcpLFxuICB9XG59KTtcblxuLyoqXG4gKiBEZWNpZGVzIGlmIGlkcyBzaG91bGQgYmUgdXNlZCBpbiBzZWxlY3RvciBnZW5lcmF0aW9uXG4gKiBAcGFyYW0ge1NlbGVjdG9yQ29uZmlnfSBzZWxlY3RvckNvbmZpZ1xuICogQHBhcmFtIHtzdHJpbmd9IGF0dHJpYnV0ZU5hbWUgdGhpcyBpcyBub3QgdXNlZCBieSB1cyBpbiB0aGlzIGNhc2UgaXMgYWx3YXlzIGVxdWFsIHdpdGggJ2lkJyBzdHJpbmcgZnJvbSBcIltpZD0naWROYW1lJ11cIlxuICogQHBhcmFtIHtzdHJpbmd9IGF0dHJpYnV0ZVZhbHVlIHRoaXMgaXMgdGhlIGlkTmFtZVxuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gaWdub3JlSWRGbihzZWxlY3RvckNvbmZpZywgYXR0cmlidXRlTmFtZSwgYXR0cmlidXRlVmFsdWUpIHtcbiAgaWYgKHNlbGVjdG9yQ29uZmlnLmlzQWxsb3dJZHMoKSkge1xuICAgIGlmIChpc1NlbGVjdG9yUmFuZG9tbHlHZW5lcmF0ZWQoYXR0cmlidXRlVmFsdWUpICYmIHNlbGVjdG9yQ29uZmlnLmlzRXhjbHVkaW5nUmFuZG9tU2VsZWN0b3JzKCkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjb25zdCBmb3JiaWRkZW5TdWJzdHJpbmdzID0gc2VsZWN0b3JDb25maWcuZ2V0Rm9yYmlkZGVuSWRTdWJzdHJpbmdzKCk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZvcmJpZGRlblN1YnN0cmluZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChhdHRyaWJ1dGVWYWx1ZS5pbmNsdWRlcyhmb3JiaWRkZW5TdWJzdHJpbmdzW2ldKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gaWdub3JlIGlkIG5hbWUgd2l0aCBmb3JiaWRkZW4gc3Vic3RyaW5nXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlOyAvLyBhbGxvdyBhbGwgaWRzIHRoYXQgcmVhY2hlZCB0aGlzIHBvaW50XG4gIH1cblxuICByZXR1cm4gdHJ1ZTsgLy8gaWdub3JlIGFsbCBpZHNcbn1cblxuLyoqXG4gKiBEZWNpZGVzIGlmIGNsYXNzZXMgc2hvdWxkIGJlIHVzZWQgaW4gc2VsZWN0b3IgZ2VuZXJhdGlvblxuICogQHBhcmFtIHtTZWxlY3RvckNvbmZpZ30gc2VsZWN0b3JDb25maWdcbiAqIEBwYXJhbSB7c3RyaW5nfSBhdHRyaWJ1dGVOYW1lIHRoaXMgaXMgbm90IHVzZWQgYnkgdXMgaW4gdGhpcyBjYXNlIGlzIGFsd2F5cyBlcXVhbCB3aXRoICdjbGFzcycgc3RyaW5nIGZyb20gXCJbY2xhc3M9J2NsYXNzTmFtZSddXCJcbiAqIEBwYXJhbSB7c3RyaW5nfSBhdHRyaWJ1dGVWYWx1ZSB0aGlzIGlzIHRoZSBjbGFzc05hbWVcbiAqIEByZXR1cm4ge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIGlnbm9yZUNsYXNzRm4oc2VsZWN0b3JDb25maWcsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVZhbHVlKSB7XG4gIGlmIChhdHRyaWJ1dGVWYWx1ZSAmJiBzZWxlY3RvckNvbmZpZy5pc0FsbG93Q2xhc3NlcygpKSB7XG4gICAgcmV0dXJuIGZhbHNlOyAvLyBhbGxvdyBhbGwgY2xhc3Nlc1xuICB9XG5cbiAgcmV0dXJuIHRydWU7IC8vIGlnbm9yZSBhbGwgY2xhc3Nlc1xufVxuXG4vKipcbiAqIERlY2lkZXMgaWYgdGFncyBzaG91bGQgYmUgdXNlZCBpbiBzZWxlY3RvciBnZW5lcmF0aW9uXG4gKiBAcGFyYW0ge1NlbGVjdG9yQ29uZmlnfSBzZWxlY3RvckNvbmZpZ1xuICogQHBhcmFtIHtzdHJpbmd9IG51bGxQYXJhbWV0ZXIgdGhpcyBpcyBub3QgdXNlZCBieSB1cyBhbmQgaXQncyBudWxsIGFsbCB0aGUgdGltZSBoZXJlXG4gKiBAcGFyYW0ge3N0cmluZ30gdGFnTmFtZVxuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gaWdub3JlVGFnRm4oc2VsZWN0b3JDb25maWcsIG51bGxQYXJhbWV0ZXIsIHRhZ05hbWUpIHtcbiAgaWYgKHNlbGVjdG9yQ29uZmlnLmlzQWxsb3dUYWdzKCkpIHtcbiAgICByZXR1cm4gZmFsc2U7IC8vIGFsbG93IGFsbCB0YWdzXG4gIH1cblxuICByZXR1cm4gdHJ1ZTsgLy8gaWdub3JlIGFsbCB0YWdzXG59XG5cbi8qKlxuICogRGVjaWRlcyBpZiBhdHRyaWJ1dGVzIHNob3VsZCBiZSB1c2VkIGluIHNlbGVjdG9yIGdlbmVyYXRpb25cbiAqIEBwYXJhbSB7U2VsZWN0b3JDb25maWd9IHNlbGVjdG9yQ29uZmlnXG4gKiBAcGFyYW0ge3N0cmluZ30gYXR0cmlidXRlTmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IGF0dHJpYnV0ZVZhbHVlXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBkZWZhdWx0UHJlZGljYXRlXG4gKiBAcmV0dXJuIHtib29sZWFufVxuICovXG5mdW5jdGlvbiBpZ25vcmVBdHRyaWJ1dGVGbihcbiAgc2VsZWN0b3JDb25maWcsXG4gIGF0dHJpYnV0ZU5hbWUsXG4gIGF0dHJpYnV0ZVZhbHVlLFxuICBkZWZhdWx0UHJlZGljYXRlXG4pIHtcbiAgaWYgKHNlbGVjdG9yQ29uZmlnLmlzQWxsb3dBdHRyaWJ1dGVzKCkpIHtcbiAgICBpZiAoKFxuICAgICAgICBpc1NlbGVjdG9yUmFuZG9tbHlHZW5lcmF0ZWQoYXR0cmlidXRlTmFtZSkgfHxcbiAgICAgICAgaXNTZWxlY3RvclJhbmRvbWx5R2VuZXJhdGVkKGF0dHJpYnV0ZVZhbHVlKVxuICAgICAgKSAmJlxuICAgICAgc2VsZWN0b3JDb25maWcuaXNFeGNsdWRpbmdSYW5kb21TZWxlY3RvcnMoKVxuICAgICkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IGZvcmJpZGRlblN1YnN0cmluZ3MgPSBzZWxlY3RvckNvbmZpZy5nZXRGb3JiaWRkZW5BdHRyaWJ1dGVTdWJzdHJpbmdzKCk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZvcmJpZGRlblN1YnN0cmluZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChhdHRyaWJ1dGVOYW1lLmluY2x1ZGVzKGZvcmJpZGRlblN1YnN0cmluZ3NbaV0pKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGFsbG93IGRlZmF1bHQgYXR0cmlidXRlc1xuICAgIHJldHVybiBkZWZhdWx0UHJlZGljYXRlKGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiB0cnVlOyAvLyBpZ25vcmUgYWxsIGF0dHJpYnV0ZXNcbn1cblxuLyoqXG4gKiBEZWNpZGVzIGlmIGEgY2xhc3NOYW1lIHNob3VsZCBiZSBleGNsdWRlZFxuICogQHBhcmFtIHtTZWxlY3RvckNvbmZpZ30gc2VsZWN0b3JDb25maWdcbiAqIEBwYXJhbSB7c3RyaW5nfSBjbGFzc05hbWVcbiAqXG4gKiBAcmV0dXJuIHtib29sZWFufVxuICovXG5mdW5jdGlvbiBleGNsdWRlQ2xhc3NGbihzZWxlY3RvckNvbmZpZywgY2xhc3NOYW1lKSB7XG4gIGlmIChjbGFzc05hbWUgJiYgY2xhc3NOYW1lLmxlbmd0aCA+IDMwKSB7XG4gICAgcmV0dXJuIHRydWU7IC8vIGlnbm9yZSBsb25nIGNsYXNzZXNcbiAgfVxuXG4gIGlmIChpc1NlbGVjdG9yUmFuZG9tbHlHZW5lcmF0ZWQoY2xhc3NOYW1lKSAmJiBzZWxlY3RvckNvbmZpZy5pc0V4Y2x1ZGluZ1JhbmRvbVNlbGVjdG9ycygpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBjb25zdCBmb3JiaWRkZW5TdWJzdHJpbmdzID0gc2VsZWN0b3JDb25maWcuZ2V0Rm9yYmlkZGVuQ2xhc3NTdWJzdHJpbmdzKCk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBmb3JiaWRkZW5TdWJzdHJpbmdzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKGNsYXNzTmFtZS5pbmNsdWRlcyhmb3JiaWRkZW5TdWJzdHJpbmdzW2ldKSkge1xuICAgICAgcmV0dXJuIHRydWU7IC8vIGlnbm9yZSBjbGFzcyBuYW1lIHdpdGggZm9yYmlkZGVuIHN1YnN0cmluZ1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmYWxzZTsgLy8gZG9uJ3QgZXhjbHVkZSBjbGFzc2VzIHdobyByZWFjaGVkIHVudGlsIGhlcmVcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBjb25maWdUb09wdGlvbnNcbn07XG4iXSwiZmlsZSI6InNlbGVjdG9yLWdlbmVyYXRpb24vcHJvZHVjZS1zZWxlY3Rvci9vcHRpb25zLWNvbnZlcnRlci5qcyJ9
