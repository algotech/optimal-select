"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.shortenSelectorByShifting = shortenSelectorByShifting;

/**
* Tries to shorten the selector if possible, starting from left
* @param {String} initialSelector The generated selector to be improved
* @param {Object} root            Document root where to search for element
* @param {JQuery} $element        The element to find a shorter selector for
*/
function shortenSelectorByShifting(initialSelector, root, $element, isCalledByRunner) {
  var shorterSelector = initialSelector.split(' ');
  var lastShifted = '';

  while (isSelectorValid(shorterSelector.join(' ')) && isSelectorUnique(root, shorterSelector, $element, isCalledByRunner)) {
    lastShifted = shorterSelector.shift();

    if (['>', '+', '~'].includes(shorterSelector[0])) {
      lastShifted += ' ' + shorterSelector.shift();
    }
  }

  var improvedSelector = "".concat(lastShifted, " ").concat(shorterSelector.join(' '));
  return improvedSelector.length < initialSelector.length ? improvedSelector : null;
}

var isSelectorUnique = function isSelectorUnique(root, selector, $element, isCalledByRunner) {
  return isCalledByRunner ? root.querySelector(selector.join(' ')) === $element && root.querySelectorAll(selector.join(' ')).length === 1 : $(root).find(selector.join(' ')).is($element) && $(root).find(selector.join(' ')).length == 1;
};
/**
* Checks if the selector is syntactically valid
* @param selector The selector to be checked
*/


function isSelectorValid(selector) {
  try {
    document.createDocumentFragment().querySelector(selector);
  } catch (e) {
    return false;
  }

  return true;
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlbGVjdG9yLWdlbmVyYXRpb24vcHJvZHVjZS1zZWxlY3Rvci9wb3N0LWdlbmVyYXRpb24tb3B0aW1pemF0aW9uLmpzIl0sIm5hbWVzIjpbInNob3J0ZW5TZWxlY3RvckJ5U2hpZnRpbmciLCJpbml0aWFsU2VsZWN0b3IiLCJyb290IiwiJGVsZW1lbnQiLCJpc0NhbGxlZEJ5UnVubmVyIiwic2hvcnRlclNlbGVjdG9yIiwic3BsaXQiLCJsYXN0U2hpZnRlZCIsImlzU2VsZWN0b3JWYWxpZCIsImpvaW4iLCJpc1NlbGVjdG9yVW5pcXVlIiwic2hpZnQiLCJpbmNsdWRlcyIsImltcHJvdmVkU2VsZWN0b3IiLCJsZW5ndGgiLCJzZWxlY3RvciIsInF1ZXJ5U2VsZWN0b3IiLCJxdWVyeVNlbGVjdG9yQWxsIiwiJCIsImZpbmQiLCJpcyIsImRvY3VtZW50IiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsImUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7Ozs7O0FBTU8sU0FBU0EseUJBQVQsQ0FBbUNDLGVBQW5DLEVBQW9EQyxJQUFwRCxFQUEwREMsUUFBMUQsRUFBb0VDLGdCQUFwRSxFQUFzRjtBQUMzRixNQUFJQyxlQUFlLEdBQUdKLGVBQWUsQ0FBQ0ssS0FBaEIsQ0FBc0IsR0FBdEIsQ0FBdEI7QUFDQSxNQUFJQyxXQUFXLEdBQUcsRUFBbEI7O0FBRUEsU0FDRUMsZUFBZSxDQUFDSCxlQUFlLENBQUNJLElBQWhCLENBQXFCLEdBQXJCLENBQUQsQ0FBZixJQUNBQyxnQkFBZ0IsQ0FBQ1IsSUFBRCxFQUFPRyxlQUFQLEVBQXdCRixRQUF4QixFQUFrQ0MsZ0JBQWxDLENBRmxCLEVBR0U7QUFDQUcsSUFBQUEsV0FBVyxHQUFHRixlQUFlLENBQUNNLEtBQWhCLEVBQWQ7O0FBQ0EsUUFBSSxDQUFDLEdBQUQsRUFBTSxHQUFOLEVBQVcsR0FBWCxFQUFnQkMsUUFBaEIsQ0FBeUJQLGVBQWUsQ0FBQyxDQUFELENBQXhDLENBQUosRUFBa0Q7QUFDaERFLE1BQUFBLFdBQVcsSUFBSSxNQUFNRixlQUFlLENBQUNNLEtBQWhCLEVBQXJCO0FBQ0Q7QUFDRjs7QUFDRCxNQUFNRSxnQkFBZ0IsYUFBTU4sV0FBTixjQUFxQkYsZUFBZSxDQUFDSSxJQUFoQixDQUFxQixHQUFyQixDQUFyQixDQUF0QjtBQUVBLFNBQU9JLGdCQUFnQixDQUFDQyxNQUFqQixHQUEwQmIsZUFBZSxDQUFDYSxNQUExQyxHQUNMRCxnQkFESyxHQUVMLElBRkY7QUFHRDs7QUFFRCxJQUFNSCxnQkFBZ0IsR0FBRyxTQUFuQkEsZ0JBQW1CLENBQUNSLElBQUQsRUFBT2EsUUFBUCxFQUFpQlosUUFBakIsRUFBMkJDLGdCQUEzQjtBQUFBLFNBQ3ZCQSxnQkFBZ0IsR0FDZEYsSUFBSSxDQUFDYyxhQUFMLENBQW1CRCxRQUFRLENBQUNOLElBQVQsQ0FBYyxHQUFkLENBQW5CLE1BQTJDTixRQUEzQyxJQUNBRCxJQUFJLENBQUNlLGdCQUFMLENBQXNCRixRQUFRLENBQUNOLElBQVQsQ0FBYyxHQUFkLENBQXRCLEVBQTBDSyxNQUExQyxLQUFxRCxDQUZ2QyxHQUlkSSxDQUFDLENBQUNoQixJQUFELENBQUQsQ0FBUWlCLElBQVIsQ0FBYUosUUFBUSxDQUFDTixJQUFULENBQWMsR0FBZCxDQUFiLEVBQWlDVyxFQUFqQyxDQUFvQ2pCLFFBQXBDLEtBQ0FlLENBQUMsQ0FBQ2hCLElBQUQsQ0FBRCxDQUFRaUIsSUFBUixDQUFhSixRQUFRLENBQUNOLElBQVQsQ0FBYyxHQUFkLENBQWIsRUFBaUNLLE1BQWpDLElBQTJDLENBTnRCO0FBQUEsQ0FBekI7QUFVQTs7Ozs7O0FBSUEsU0FBU04sZUFBVCxDQUF5Qk8sUUFBekIsRUFBbUM7QUFDakMsTUFBSTtBQUNGTSxJQUFBQSxRQUFRLENBQUNDLHNCQUFULEdBQWtDTixhQUFsQyxDQUFnREQsUUFBaEQ7QUFDRCxHQUZELENBRUUsT0FBT1EsQ0FBUCxFQUFVO0FBQ1YsV0FBTyxLQUFQO0FBQ0Q7O0FBRUQsU0FBTyxJQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiogVHJpZXMgdG8gc2hvcnRlbiB0aGUgc2VsZWN0b3IgaWYgcG9zc2libGUsIHN0YXJ0aW5nIGZyb20gbGVmdFxuKiBAcGFyYW0ge1N0cmluZ30gaW5pdGlhbFNlbGVjdG9yIFRoZSBnZW5lcmF0ZWQgc2VsZWN0b3IgdG8gYmUgaW1wcm92ZWRcbiogQHBhcmFtIHtPYmplY3R9IHJvb3QgICAgICAgICAgICBEb2N1bWVudCByb290IHdoZXJlIHRvIHNlYXJjaCBmb3IgZWxlbWVudFxuKiBAcGFyYW0ge0pRdWVyeX0gJGVsZW1lbnQgICAgICAgIFRoZSBlbGVtZW50IHRvIGZpbmQgYSBzaG9ydGVyIHNlbGVjdG9yIGZvclxuKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG9ydGVuU2VsZWN0b3JCeVNoaWZ0aW5nKGluaXRpYWxTZWxlY3Rvciwgcm9vdCwgJGVsZW1lbnQsIGlzQ2FsbGVkQnlSdW5uZXIpIHtcbiAgbGV0IHNob3J0ZXJTZWxlY3RvciA9IGluaXRpYWxTZWxlY3Rvci5zcGxpdCgnICcpO1xuICBsZXQgbGFzdFNoaWZ0ZWQgPSAnJztcblxuICB3aGlsZSAoXG4gICAgaXNTZWxlY3RvclZhbGlkKHNob3J0ZXJTZWxlY3Rvci5qb2luKCcgJykpICYmXG4gICAgaXNTZWxlY3RvclVuaXF1ZShyb290LCBzaG9ydGVyU2VsZWN0b3IsICRlbGVtZW50LCBpc0NhbGxlZEJ5UnVubmVyKVxuICApIHtcbiAgICBsYXN0U2hpZnRlZCA9IHNob3J0ZXJTZWxlY3Rvci5zaGlmdCgpO1xuICAgIGlmIChbJz4nLCAnKycsICd+J10uaW5jbHVkZXMoc2hvcnRlclNlbGVjdG9yWzBdKSkge1xuICAgICAgbGFzdFNoaWZ0ZWQgKz0gJyAnICsgc2hvcnRlclNlbGVjdG9yLnNoaWZ0KCk7XG4gICAgfVxuICB9XG4gIGNvbnN0IGltcHJvdmVkU2VsZWN0b3IgPSBgJHtsYXN0U2hpZnRlZH0gJHtzaG9ydGVyU2VsZWN0b3Iuam9pbignICcpfWA7XG5cbiAgcmV0dXJuIGltcHJvdmVkU2VsZWN0b3IubGVuZ3RoIDwgaW5pdGlhbFNlbGVjdG9yLmxlbmd0aCA/XG4gICAgaW1wcm92ZWRTZWxlY3RvciA6XG4gICAgbnVsbDtcbn1cblxuY29uc3QgaXNTZWxlY3RvclVuaXF1ZSA9IChyb290LCBzZWxlY3RvciwgJGVsZW1lbnQsIGlzQ2FsbGVkQnlSdW5uZXIpID0+IChcbiAgaXNDYWxsZWRCeVJ1bm5lciA/IChcbiAgICByb290LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3Iuam9pbignICcpKSA9PT0gJGVsZW1lbnQgJiZcbiAgICByb290LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3Iuam9pbignICcpKS5sZW5ndGggPT09IDFcbiAgKSA6IChcbiAgICAkKHJvb3QpLmZpbmQoc2VsZWN0b3Iuam9pbignICcpKS5pcygkZWxlbWVudCkgJiZcbiAgICAkKHJvb3QpLmZpbmQoc2VsZWN0b3Iuam9pbignICcpKS5sZW5ndGggPT0gMVxuICApXG4pO1xuXG4vKipcbiogQ2hlY2tzIGlmIHRoZSBzZWxlY3RvciBpcyBzeW50YWN0aWNhbGx5IHZhbGlkXG4qIEBwYXJhbSBzZWxlY3RvciBUaGUgc2VsZWN0b3IgdG8gYmUgY2hlY2tlZFxuKi9cbmZ1bmN0aW9uIGlzU2VsZWN0b3JWYWxpZChzZWxlY3Rvcikge1xuICB0cnkge1xuICAgIGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKS5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufVxuIl0sImZpbGUiOiJzZWxlY3Rvci1nZW5lcmF0aW9uL3Byb2R1Y2Utc2VsZWN0b3IvcG9zdC1nZW5lcmF0aW9uLW9wdGltaXphdGlvbi5qcyJ9
